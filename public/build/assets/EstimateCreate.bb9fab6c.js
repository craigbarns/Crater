import{ad as x,J as A,E as M,r,o as g,c as P,a,x as t,h as l,az as J,H as O,ai as K,l as Q,d as C,M as W,m as X,e as v,p as f,q as B,am as Z,ak as ee,Y as te,v as ae,j as y,g as k,b as $,t as L,n as se,z as ne,w as ie,F as oe}from"./main.c3e461b0.js";import{_ as le,a as re,b as me,c as de,d as ue,e as ce,f as ge}from"./SalesTax.70f3606c.js";import{_ as pe}from"./CreateCustomFields.20b080b4.js";import{_ as _e}from"./ExchangeRateConverter.eb086105.js";import{_ as fe}from"./TaxTypeModal.8fe38972.js";import"./DragIcon.a80a1c24.js";import"./SelectNotePopup.8990bbaf.js";import"./NoteModal.82624830.js";import"./payment.3479f873.js";import"./exchange-rate.609456cc.js";const ve={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},ye={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(s){const e=x(),b=A();return M(()=>e.newEstimate.currency_id,d=>{const i=b.currencies.find(m=>m.id===d);i&&(e.newEstimate.selectedCurrency=i)}),(d,i)=>{const m=r("BaseCustomerSelectPopup"),c=r("BaseDatePicker"),p=r("BaseInputGroup"),S=r("BaseInput"),E=r("BaseMultiselect"),h=r("BaseInputGrid");return g(),P("div",ve,[a(m,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":i[0]||(i[0]=n=>t(e).newEstimate.customer=n),valid:s.v.customer_id,"content-loading":s.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(h,{class:"col-span-7"},{default:l(()=>[a(p,{label:d.$t("reports.estimates.estimate_date"),"content-loading":s.isLoading,required:"",error:s.v.estimate_date.$error&&s.v.estimate_date.$errors[0].$message},{default:l(()=>[a(c,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":i[1]||(i[1]=n=>t(e).newEstimate.estimate_date=n),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(p,{label:d.$t("estimates.expiry_date"),"content-loading":s.isLoading},{default:l(()=>[a(c,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":i[2]||(i[2]=n=>t(e).newEstimate.expiry_date=n),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(p,{label:d.$t("estimates.estimate_number"),"content-loading":s.isLoading,required:"",error:s.v.estimate_number.$error&&s.v.estimate_number.$errors[0].$message},{default:l(()=>[a(S,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":i[3]||(i[3]=n=>t(e).newEstimate.estimate_number=n),"content-loading":s.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(p,{label:d.$t("settings.preferences.currency"),"content-loading":s.isLoading},{default:l(()=>[a(E,{modelValue:t(e).newEstimate.currency_id,"onUpdate:modelValue":i[4]||(i[4]=n=>t(e).newEstimate.currency_id=n),"content-loading":s.isLoading,options:t(b).currencies,label:"name","value-prop":"id",searchable:!0,"track-by":"name",class:"w-full"},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"]),a(_e,{store:t(e),"store-prop":"newEstimate",v:s.v,"is-loading":s.isLoading,"is-edit":s.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},be={class:"flex"},Ee={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},we={class:"relative w-full lg:w-1/2"},V="newEstimate",xe={__name:"EstimateCreate",setup(s){const e=x(),b=J(),d=O(),i=K(),{t:m}=Q();let c=C(!1);const p=C(!1),S=C(["customer","company","customerCustom","estimate","estimateCustom"]);let E=W(),h=X(),n=v(()=>e.isFetchingInitialSettings),F=v(()=>_.value?m("estimates.edit_estimate"):m("estimates.new_estimate")),_=v(()=>E.name==="estimates.edit");const T=v(()=>d.selectedCompanySettings.sales_tax_us_enabled==="YES"&&b.salesTaxUSEnabled),U={estimate_date:{required:f.withMessage(m("validation.required"),B)},estimate_number:{required:f.withMessage(m("validation.required"),B)},reference_number:{maxLength:f.withMessage(m("validation.price_maxlength"),Z(255))},customer_id:{required:f.withMessage(m("validation.required"),B)},exchange_rate:{required:ee(function(){return f.withMessage(m("validation.required"),B),e.showExchangeRate}),decimal:f.withMessage(m("validation.valid_exchange_rate"),te)}},w=ae(U,v(()=>e.newEstimate),{$scope:V});M(()=>e.newEstimate.customer,o=>{o&&o.currency?e.newEstimate.selectedCurrency=o.currency:e.newEstimate.selectedCurrency=d.selectedCompanyCurrency}),e.resetCurrentEstimate(),i.resetCustomFields(),w.value.$reset,e.fetchEstimateInitialSettings(_.value);async function G(){if(w.value.$touch(),w.value.$invalid)return!1;c.value=!0;let o={...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};const q=_.value?e.updateEstimate:e.addEstimate;try{let u=await q(o);u.data.data&&h.push(`/admin/estimates/${u.data.data.id}/view`)}catch(u){console.error(u)}c.value=!1}return(o,q)=>{const u=r("BaseBreadcrumbItem"),N=r("BaseBreadcrumb"),I=r("BaseButton"),D=r("router-link"),j=r("BaseIcon"),z=r("BasePageHeader"),H=r("BaseScrollPane"),R=r("BasePage");return g(),P(oe,null,[a(le),a(re),a(fe),T.value&&(!t(n)||t(E).query.customer)?(g(),y(me,{key:0,store:t(e),"store-prop":"newEstimate","is-edit":t(_),customer:t(e).newEstimate.customer},null,8,["store","is-edit","customer"])):k("",!0),a(R,{class:"relative estimate-create-page"},{default:l(()=>[$("form",{onSubmit:ie(G,["prevent"])},[a(z,{title:t(F)},{actions:l(()=>[o.$route.name==="estimates.edit"?(g(),y(D,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:l(()=>[a(I,{class:"mr-3",variant:"primary-outline",type:"button"},{default:l(()=>[$("span",be,L(o.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):k("",!0),a(I,{loading:t(c),disabled:t(c),"content-loading":t(n),variant:"primary",type:"submit"},{left:l(Y=>[t(c)?k("",!0):(g(),y(j,{key:0,class:se(Y.class),name:"SaveIcon"},null,8,["class"]))]),default:l(()=>[ne(" "+L(o.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:l(()=>[a(N,null,{default:l(()=>[a(u,{title:o.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(u,{title:o.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),o.$route.name==="estimates.edit"?(g(),y(u,{key:0,title:o.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(g(),y(u,{key:1,title:o.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(ye,{v:t(w),"is-loading":t(n),"is-edit":t(_)},null,8,["v","is-loading","is-edit"]),a(H,null,{default:l(()=>[a(de,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(n),"item-validation-scope":V,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),$("div",Ee,[$("div",we,[a(ue,{store:t(e),"store-prop":"newEstimate",fields:S.value,type:"Estimate"},null,8,["store","fields"]),a(pe,{type:"Estimate","is-edit":t(_),"is-loading":t(n),store:t(e),"store-prop":"newEstimate","custom-field-scope":V,class:"mb-6"},null,8,["is-edit","is-loading","store"]),a(ce,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":p.value},null,8,["store","is-mark-as-default"])]),a(ge,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(n),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{xe as default};
