import{ay as Z,I as K,N as ne,d as R,K as ye,a5 as re,l as H,e as B,E as oe,r as x,o as r,c as $,b as a,t as g,a as s,a6 as Be,x as p,h as c,z as A,j as D,g as E,H as ee,au as fe,M as Ie,P as X,p as U,q as Y,aI as pe,am as te,aA as Se,v as le,F as J,i as Q,R as ie,aK as Te,ar as xe,a8 as Pe,aL as ke,n as G,O as Ce,aM as Me,aN as De,ad as Ve,u as je,L as qe,f as _e,w as ge,J as Ae}from"./main.d6c8e3cd.js";import{D as Ee,d as Le}from"./DragIcon.fbf71c3a.js";import{_ as Ue}from"./SelectNotePopup.e4eed053.js";const Oe={class:"flex items-center justify-between mb-3"},ze={class:"flex items-center text-base",style:{flex:"4"}},Ne={class:"pr-2 mb-0",align:"right"},Fe={class:"absolute left-3.5"},Ye={class:"ml-2 text-sm leading-none cursor-pointer text-primary-400"},Ge=a("br",null,null,-1),Re={class:"text-sm text-right",style:{flex:"3"}},We={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Xe={__name:"CreateItemRowTax",props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},discountedTotal:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(t,{emit:_}){const e=t,n=_,I=Z(),h=K(),m=ne(),S=R(null),k=ye({...e.taxData});re("utils");const{t:y}=H(),C=B(()=>I.taxTypes.map(v=>({...v})).map(v=>(e.taxes.find(o=>o.tax_type_id===v.id)?v.disabled=!0:v.disabled=!1,v))),j=B(()=>k.compound_tax&&e.discountedTotal?(e.discountedTotal+e.totalTax)*k.percent/100:e.discountedTotal&&k.percent?e.discountedTotal*k.percent/100:0);oe(()=>e.discountedTotal,()=>{i()}),oe(()=>e.totalTax,()=>{i()}),e.taxData.tax_type_id>0&&(S.value=I.taxTypes.find(d=>d.id===e.taxData.tax_type_id)),i();function q(d){k.percent=d.percent,k.tax_type_id=d.id,k.compound_tax=d.compound_tax,k.name=d.name,i()}function i(){k.tax_type_id!==0&&n("update",{index:e.index,item:{...k,amount:j.value}})}function u(){let d={itemIndex:e.itemIndex,taxIndex:e.index};h.openModal({title:y("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:d,size:"sm"})}function l(d){e.store.$patch(v=>{v[e.storeProp].items[e.itemIndex].taxes.splice(d,1)})}return(d,v)=>{const b=x("BaseIcon"),o=x("BaseMultiselect"),w=x("BaseFormatMoney");return r(),$("div",Oe,[a("div",ze,[a("label",Ne,g(d.$t("invoices.item.tax")),1),s(o,{modelValue:S.value,"onUpdate:modelValue":[v[0]||(v[0]=T=>S.value=T),v[1]||(v[1]=T=>q(T))],"value-prop":"id",options:C.value,placeholder:d.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},Be({singlelabel:c(({value:T})=>[a("div",Fe,g(T.name)+" - "+g(T.percent)+" % ",1)]),option:c(({option:T})=>[A(g(T.name)+" - "+g(T.percent)+" % ",1)]),_:2},[p(m).hasAbilities(t.ability)?{name:"action",fn:c(()=>[a("button",{type:"button",class:"flex items-center justify-center w-full px-2 py-2 bg-gray-200 border-none outline-none cursor-pointer",onClick:u},[s(b,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),a("label",Ye,g(d.$t("invoices.add_new_tax")),1)])]),key:"0"}:void 0]),1032,["modelValue","options","placeholder"]),Ge]),a("div",Re,[s(w,{amount:j.value,currency:t.currency},null,8,["amount","currency"])]),a("div",We,[t.taxes.length&&t.index!==t.taxes.length-1?(r(),D(b,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:v[2]||(v[2]=T=>l(t.index))})):E("",!0)])])}}},Ke={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},He={colspan:"5",class:"p-0 text-left align-top"},Je={class:"w-full"},Qe=a("col",{style:{width:"40%","min-width":"280px"}},null,-1),Ze=a("col",{style:{width:"10%","min-width":"120px"}},null,-1),et=a("col",{style:{width:"15%","min-width":"120px"}},null,-1),tt={key:0,style:{width:"15%","min-width":"160px"}},st=a("col",{style:{width:"15%","min-width":"120px"}},null,-1),at={class:"px-5 py-4 text-left align-top"},ot={class:"flex justify-start"},nt={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},rt={class:"flex-1"},lt={class:"flex gap-2 mt-2"},it={class:"px-5 py-4 text-right align-top"},dt={class:"px-5 py-4 text-left align-top"},ct={class:"flex flex-col"},ut={class:"flex-auto flex-fill bd-highlight"},mt={class:"relative w-full"},pt={key:0,class:"px-5 py-4 text-left align-top"},yt={class:"flex flex-col"},ft={class:"flex",style:{width:"120px"},role:"group"},xt={class:"flex items-center"},_t={class:"px-5 py-4 text-right align-top"},gt={class:"flex items-center justify-end text-sm"},ht={class:"flex items-center justify-center w-6 h-10 mx-2"},vt={key:0},bt=a("td",{class:"px-5 py-4 text-left align-top"},null,-1),$t={colspan:"4",class:"px-5 py-4 text-left align-top"},wt={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(t,{emit:_}){const e=t,n=ee(),I=fe();Ie();const{t:h}=H(),m=B({get:()=>e.itemData.hs_code,set:f=>O("hs_code",f)}),S=B({get:()=>e.itemData.unit,set:f=>O("unit",f)}),k=B({get:()=>e.itemData.quantity,set:f=>{O("quantity",parseFloat(f))}}),y=B({get:()=>{const f=e.itemData.price;return parseFloat(f)>0?f/100:f},set:f=>{if(parseFloat(f)>0){let P=Math.round(f*100);O("price",P)}else O("price",f)}}),C=B(()=>e.itemData.price*e.itemData.quantity),j=B({get:()=>e.itemData.discount,set:f=>{e.itemData.discount_type==="percentage"?O("discount_val",C.value*f/100):O("discount_val",Math.round(f*100)),O("discount",f)}}),q=B(()=>C.value-e.itemData.discount_val),i=B(()=>e.currency?e.currency:n.selectedCompanyCurrency),u=B(()=>e.store[e.storeProp].items.length!=1),l=B(()=>Math.round(X.exports.sumBy(e.itemData.taxes,function(f){return f.compound_tax?0:f.amount}))),d=B(()=>Math.round(X.exports.sumBy(e.itemData.taxes,function(f){return f.compound_tax?f.amount:0}))),v=B(()=>l.value+d.value),b={name:{required:U.withMessage(h("validation.required"),Y)},quantity:{required:U.withMessage(h("validation.required"),Y),minValue:U.withMessage(h("validation.qty_must_greater_than_zero"),pe(0)),maxLength:U.withMessage(h("validation.amount_maxlength"),te(20))},price:{required:U.withMessage(h("validation.required"),Y),minValue:U.withMessage(h("validation.number_length_minvalue"),pe(1)),maxLength:U.withMessage(h("validation.price_maxlength"),te(20))},discount_val:{between:U.withMessage(h("validation.discount_maxlength"),Se(0,B(()=>C.value)))},description:{maxLength:U.withMessage(h("validation.notes_maxlength"),te(65e3))}},o=le(b,B(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function w(f){e.store.$patch(V=>{V[e.storeProp].items[e.index].taxes[f.index]=f.item});let P=e.itemData.taxes[e.itemData.taxes.length-1];(P==null?void 0:P.tax_type_id)!==0&&e.store.$patch(V=>{V[e.storeProp].items[e.index].taxes.push({...Te,id:xe.raw()})}),W()}function T(f){O("name",f)}function L(f){e.store.$patch(P=>{if(P[e.storeProp].items[e.index].name=f.name,P[e.storeProp].items[e.index].price=f.price,P[e.storeProp].items[e.index].item_id=f.id,P[e.storeProp].items[e.index].description=f.description,f.unit&&(P[e.storeProp].items[e.index].unit_name=f.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&f.taxes){let V=0;f.taxes.forEach(N=>{w({index:V,item:{...N}}),V++})}P[e.storeProp].exchange_rate&&(P[e.storeProp].items[e.index].price/=P[e.storeProp].exchange_rate)}),I.fetchItems(),W()}function M(){e.itemData.discount_type!=="fixed"&&(O("discount_val",Math.round(e.itemData.discount*100)),O("discount_type","fixed"))}function F(){e.itemData.discount_type!=="percentage"&&(O("discount_val",C.value*e.itemData.discount/100),O("discount_type","percentage"))}function W(){var V,N;let f=(N=(V=e.store[e.storeProp])==null?void 0:V.items[e.index])==null?void 0:N.taxes;f||(f=[]);let P={...e.store[e.storeProp].items[e.index],index:e.index,total:q.value,sub_total:C.value,totalSimpleTax:l.value,totalCompoundTax:d.value,totalTax:v.value,tax:v.value,taxes:[...f]};e.store.updateItem(P)}function O(f,P){e.store.$patch(V=>{V[e.storeProp].items[e.index][f]=P}),W()}return(f,P)=>{const V=x("BaseItemSelect"),N=x("BaseInput"),he=x("BaseMoney"),de=x("BaseIcon"),ve=x("BaseButton"),ce=x("BaseDropdownItem"),be=x("BaseDropdown"),ue=x("BaseContentPlaceholdersText"),me=x("BaseContentPlaceholders"),$e=x("BaseFormatMoney");return r(),$("tr",Ke,[a("td",He,[a("table",Je,[a("colgroup",null,[Qe,Ze,et,t.store[t.storeProp].discount_per_item==="YES"?(r(),$("col",tt)):E("",!0),st]),a("tbody",null,[a("tr",null,[a("td",at,[a("div",ot,[a("div",nt,[s(Ee)]),a("div",rt,[s(V,{type:"Invoice",item:t.itemData,invalid:p(o).name.$error,"invalid-description":p(o).description.$error,taxes:t.itemData.taxes,index:t.index,"store-prop":t.storeProp,store:t.store,onSearch:T,onSelect:L},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"]),a("div",lt,[s(N,{modelValue:m.value,"onUpdate:modelValue":P[0]||(P[0]=z=>m.value=z),"content-loading":t.loading,placeholder:f.$t("trade.hs_code_placeholder"),class:"text-xs",style:{"max-width":"140px"}},null,8,["modelValue","content-loading","placeholder"]),s(N,{modelValue:S.value,"onUpdate:modelValue":P[1]||(P[1]=z=>S.value=z),"content-loading":t.loading,placeholder:f.$t("trade.unit_placeholder"),class:"text-xs",style:{"max-width":"80px"}},null,8,["modelValue","content-loading","placeholder"])])])])]),a("td",it,[s(N,{modelValue:k.value,"onUpdate:modelValue":P[2]||(P[2]=z=>k.value=z),invalid:p(o).quantity.$error,"content-loading":t.loading,type:"number",small:"",min:"0",step:"any",onChange:P[3]||(P[3]=z=>W()),onInput:P[4]||(P[4]=z=>p(o).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),a("td",dt,[a("div",ct,[a("div",ut,[a("div",mt,[(r(),D(he,{key:i.value,modelValue:y.value,"onUpdate:modelValue":P[5]||(P[5]=z=>y.value=z),invalid:p(o).price.$error,"content-loading":t.loading,currency:i.value},null,8,["modelValue","invalid","content-loading","currency"]))])])])]),t.store[t.storeProp].discount_per_item==="YES"?(r(),$("td",pt,[a("div",yt,[a("div",ft,[s(N,{modelValue:j.value,"onUpdate:modelValue":P[6]||(P[6]=z=>j.value=z),invalid:p(o).discount_val.$error,"content-loading":t.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),s(be,{position:"bottom-end"},{activator:c(()=>[s(ve,{"content-loading":t.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[a("span",xt,[A(g(t.itemData.discount_type=="fixed"?t.currency.symbol:"%")+" ",1),s(de,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1},8,["content-loading"])]),default:c(()=>[s(ce,{onClick:M},{default:c(()=>[A(g(f.$t("general.fixed")),1)]),_:1}),s(ce,{onClick:F},{default:c(()=>[A(g(f.$t("general.percentage")),1)]),_:1})]),_:1})])])])):E("",!0),a("td",_t,[a("div",gt,[a("span",null,[t.loading?(r(),D(me,{key:0},{default:c(()=>[s(ue,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),D($e,{key:1,amount:q.value,currency:i.value},null,8,["amount","currency"]))]),a("div",ht,[u.value?(r(),D(de,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:P[7]||(P[7]=z=>t.store.removeItem(t.index))})):E("",!0)])])])]),t.store[t.storeProp].tax_per_item==="YES"?(r(),$("tr",vt,[bt,a("td",$t,[t.loading?(r(),D(me,{key:0},{default:c(()=>[s(ue,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(r(!0),$(J,{key:1},Q(t.itemData.taxes,(z,we)=>(r(),D(Xe,{key:z.id,index:we,"item-index":t.index,"tax-data":z,taxes:t.itemData.taxes,"discounted-total":q.value,"total-tax":l.value,total:C.value,currency:t.currency,"update-items":W,ability:p(ie).CREATE_INVOICE,store:t.store,"store-prop":t.storeProp,discount:j.value,onUpdate:w},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop","discount"]))),128))])])):E("",!0)])])])])}}},Bt={class:"text-center item-table min-w-full"},It=a("col",{style:{width:"40%","min-width":"280px"}},null,-1),St=a("col",{style:{width:"10%","min-width":"120px"}},null,-1),Tt=a("col",{style:{width:"15%","min-width":"120px"}},null,-1),Pt={key:0,style:{width:"15%","min-width":"160px"}},kt=a("col",{style:{width:"15%","min-width":"120px"}},null,-1),Ct={class:"bg-white border border-gray-200 border-solid"},Mt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Dt={key:1,class:"pl-7"},Vt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},jt={key:1},qt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},At={key:1},Et={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Lt={key:1},Ut={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Ot={key:1,class:"pr-10 column-heading"},Gs={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(t){const _=t,e=ee(),n=B(()=>_.currency?_.currency:e.selectedCompanyCurrency);return(I,h)=>{const m=x("BaseContentPlaceholdersText"),S=x("BaseContentPlaceholders"),k=x("BaseIcon");return r(),$(J,null,[a("table",Bt,[a("colgroup",null,[It,St,Tt,t.store[t.storeProp].discount_per_item==="YES"?(r(),$("col",Pt)):E("",!0),kt]),a("thead",Ct,[a("tr",null,[a("th",Mt,[t.isLoading?(r(),D(S,{key:0},{default:c(()=>[s(m,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("span",Dt,g(I.$tc("items.item",2)),1))]),a("th",Vt,[t.isLoading?(r(),D(S,{key:0},{default:c(()=>[s(m,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("span",jt,g(I.$t("invoices.item.quantity")),1))]),a("th",qt,[t.isLoading?(r(),D(S,{key:0},{default:c(()=>[s(m,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("span",At,g(I.$t("invoices.item.price")),1))]),t.store[t.storeProp].discount_per_item==="YES"?(r(),$("th",Et,[t.isLoading?(r(),D(S,{key:0},{default:c(()=>[s(m,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("span",Lt,g(I.$t("invoices.item.discount")),1))])):E("",!0),a("th",Ut,[t.isLoading?(r(),D(S,{key:0},{default:c(()=>[s(m,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("span",Ot,g(I.$t("invoices.item.amount")),1))])])]),s(p(Le),{modelValue:t.store[t.storeProp].items,"onUpdate:modelValue":h[0]||(h[0]=y=>t.store[t.storeProp].items=y),"item-key":"id",tag:"tbody",handle:".handle"},{item:c(({element:y,index:C})=>[(r(),D(wt,{key:y.id,index:C,"item-data":y,loading:t.isLoading,currency:n.value,"item-validation-scope":t.itemValidationScope,"invoice-items":t.store[t.storeProp].items,store:t.store,"store-prop":t.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),a("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:h[1]||(h[1]=(...y)=>t.store.addItem&&t.store.addItem(...y))},[s(k,{name:"PlusCircleIcon",class:"mr-2"}),A(" "+g(I.$t("general.add_new_item")),1)])],64)}}},zt={class:"flex items-center justify-between w-full mt-2 text-sm"},Nt={class:"font-semibold leading-5 text-gray-500 uppercase"},Ft={class:"flex items-center justify-center text-lg text-black"},Yt={__name:"CreateTotalTaxes",props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(t,{emit:_}){const e=t,n=_;re("$utils");const I=B(()=>e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);Pe(()=>{e.store.getSubtotalWithDiscount&&h(),e.store.getTotalSimpleTax&&h()});function h(){n("update",{...e.tax,amount:I.value})}return(m,S)=>{const k=x("BaseFormatMoney"),y=x("BaseIcon");return r(),$("div",zt,[a("label",Nt,g(t.tax.name)+" ("+g(t.tax.percent)+" %) ",1),a("label",Ft,[s(k,{amount:t.tax.amount,currency:t.currency},null,8,["amount","currency"]),s(y,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:S[0]||(S[0]=C=>m.$emit("remove",t.tax.id))})])])}}},Gt={class:"w-full mt-4 tax-select"},Rt={class:"relative w-full max-w-md px-4"},Wt={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},Xt={class:"relative bg-white"},Kt={class:"relative p-4"},Ht={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Jt=["onClick"],Qt={class:"flex justify-between px-2"},Zt={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},es={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},ts={key:1,class:"flex justify-center p-5 text-gray-400"},ss={class:"text-base text-gray-500 cursor-pointer"},as={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},os={__name:"SelectTaxPopup",props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(t,{emit:_}){const e=t,n=_,I=K(),h=Z(),m=ne(),{t:S}=H(),k=R(null),y=B(()=>k.value?h.taxTypes.filter(function(i){return i.name.toLowerCase().indexOf(k.value.toLowerCase())!==-1}):h.taxTypes),C=B(()=>e.store[e.storeProp].taxes);function j(i,u){n("select:taxType",{...i}),u()}function q(){I.openModal({title:S("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:i=>n("select:taxType",i)})}return(i,u)=>{const l=x("BaseIcon"),d=x("BaseInput");return r(),$("div",Gt,[s(p(De),{class:"relative"},{default:c(({isOpen:v})=>[s(p(ke),{class:G([v?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:c(()=>[s(l,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),A(" "+g(i.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),a("div",Rt,[s(Ce,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[s(p(Me),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:c(({close:b})=>[a("div",Wt,[a("div",Xt,[a("div",Kt,[s(d,{modelValue:k.value,"onUpdate:modelValue":u[0]||(u[0]=o=>k.value=o),placeholder:i.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),y.value.length>0?(r(),$("div",Ht,[(r(!0),$(J,null,Q(y.value,(o,w)=>(r(),$("div",{key:w,class:G([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":C.value.find(T=>T.tax_type_id===o.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:T=>j(o,b)},[a("div",Qt,[a("label",Zt,g(o.name),1),a("label",es,g(o.percent)+" % ",1)])],10,Jt))),128))])):(r(),$("div",ts,[a("label",ss,g(i.$t("general.no_tax_found")),1)]))]),p(m).hasAbilities(p(ie).CREATE_TAX_TYPE)?(r(),$("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:q},[s(l,{name:"CheckCircleIcon",class:"text-primary-400"}),a("label",as,g(i.$t("estimates.add_new_tax")),1)])):E("",!0)])]),_:1})]),_:1})])]),_:1})])}}},ns={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},rs={class:"flex items-center justify-between w-full"},ls={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},is={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ds={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},cs={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},us={key:0,class:"flex items-center justify-between w-full mt-2"},ms={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},ps={key:3,class:"flex",style:{width:"140px"},role:"group"},ys={class:"flex items-center"},fs={key:1},xs={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},_s={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},gs={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Rs={__name:"CreateTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(t){const _=R(null),e=t;re("$utils");const n=ee(),I=B({get:()=>e.store[e.storeProp].discount,set:i=>{e.store[e.storeProp].discount_type==="percentage"?e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*i/100):e.store[e.storeProp].discount_val=Math.round(i*100),e.store[e.storeProp].discount=i}}),h=B({get:()=>e.store[e.storeProp].taxes,set:i=>{e.store.$patch(u=>{u[e.storeProp].taxes=i})}}),m=B(()=>{let i=[];return e.store[e.storeProp].items.forEach(u=>{u.taxes&&u.taxes.forEach(l=>{let d=i.find(v=>v.tax_type_id===l.tax_type_id);d?d.amount+=l.amount:l.tax_type_id&&i.push({tax_type_id:l.tax_type_id,amount:l.amount,percent:l.percent,name:l.name})})}),i}),S=B(()=>e.currency?e.currency:n.selectedCompanyCurrency);function k(){e.store[e.storeProp].discount_type!=="fixed"&&(e.store[e.storeProp].discount_val=Math.round(e.store[e.storeProp].discount*100),e.store[e.storeProp].discount_type="fixed")}function y(){e.store[e.storeProp].discount_type!=="percentage"&&(e.store[e.storeProp].discount_val=e.store.getSubTotal*e.store[e.storeProp].discount/100,e.store[e.storeProp].discount_type="percentage")}function C(i){let u=0;i.compound_tax&&e.store.getSubtotalWithDiscount?u=Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*i.percent/100):e.store.getSubtotalWithDiscount&&i.percent&&(u=Math.round(e.store.getSubtotalWithDiscount*i.percent/100));let l={...ie,id:xe.raw(),name:i.name,percent:i.percent,compound_tax:i.compound_tax,tax_type_id:i.id,amount:u};e.store.$patch(d=>{d[e.storeProp].taxes.push({...l})})}function j(i){const u=e.store[e.storeProp].taxes.find(l=>l.id===i.id);u&&Object.assign(u,{...i})}function q(i){const u=e.store[e.storeProp].taxes.findIndex(l=>l.id===i);e.store.$patch(l=>{l[e.storeProp].taxes.splice(u,1)})}return(i,u)=>{const l=x("BaseContentPlaceholdersText"),d=x("BaseContentPlaceholders"),v=x("BaseFormatMoney"),b=x("BaseInput"),o=x("BaseIcon"),w=x("BaseButton"),T=x("BaseDropdownItem"),L=x("BaseDropdown");return r(),$("div",ns,[a("div",rs,[t.isLoading?(r(),D(d,{key:0},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("label",ls,g(i.$t("estimates.sub_total")),1)),t.isLoading?(r(),D(d,{key:2},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("label",is,[s(v,{amount:t.store.getSubTotal,currency:S.value},null,8,["amount","currency"])]))]),(r(!0),$(J,null,Q(m.value,M=>(r(),$("div",{key:M.tax_type_id,class:"flex items-center justify-between w-full"},[t.isLoading?(r(),D(d,{key:0},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(r(),$("label",ds,g(M.name)+" - "+g(M.percent)+"% ",1)):E("",!0),t.isLoading?(r(),D(d,{key:2},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):t.store[t.storeProp].tax_per_item==="YES"?(r(),$("label",cs,[s(v,{amount:M.amount,currency:S.value},null,8,["amount","currency"])])):E("",!0)]))),128)),t.store[t.storeProp].discount_per_item==="NO"||t.store[t.storeProp].discount_per_item===null?(r(),$("div",us,[t.isLoading?(r(),D(d,{key:0},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("label",ms,g(i.$t("estimates.discount")),1)),t.isLoading?(r(),D(d,{key:2},{default:c(()=>[s(l,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(r(),$("div",ps,[s(b,{modelValue:I.value,"onUpdate:modelValue":u[0]||(u[0]=M=>I.value=M),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),s(L,{position:"bottom-end"},{activator:c(()=>[s(w,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:c(()=>[a("span",ys,[A(g(t.store[t.storeProp].discount_type=="fixed"?S.value.symbol:"%")+" ",1),s(o,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:c(()=>[s(T,{onClick:k},{default:c(()=>[A(g(i.$t("general.fixed")),1)]),_:1}),s(T,{onClick:y},{default:c(()=>[A(g(i.$t("general.percentage")),1)]),_:1})]),_:1})]))])):E("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(r(),$("div",fs,[(r(!0),$(J,null,Q(h.value,(M,F)=>(r(),D(Yt,{key:M.id,index:F,tax:M,taxes:h.value,currency:t.currency,store:t.store,onRemove:q,onUpdate:j},null,8,["index","tax","taxes","currency","store"]))),128))])):E("",!0),t.store[t.storeProp].tax_per_item==="NO"||t.store[t.storeProp].tax_per_item===null?(r(),$("div",{key:2,ref_key:"taxModal",ref:_,class:"float-right pt-2 pb-4"},[s(os,{"store-prop":t.storeProp,store:t.store,type:t.taxPopupType,"onSelect:taxType":C},null,8,["store-prop","store","type"])],512)):E("",!0),a("div",xs,[t.isLoading?(r(),D(d,{key:0},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("label",_s,g(i.$t("estimates.total"))+" "+g(i.$t("estimates.amount"))+":",1)),t.isLoading?(r(),D(d,{key:2},{default:c(()=>[s(l,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),$("label",gs,[s(v,{amount:t.store.getTotal,currency:S.value},null,8,["amount","currency"])]))])])}}},hs={class:"flex text-gray-800 font-medium text-sm mb-2"},vs=a("span",{class:"text-sm text-red-500"}," *",-1),Ws={__name:"SelectTemplateButton",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(t){const _=t,e=K(),{t:n}=H();function I(){let h="";_.storeProp=="newEstimate"?h=n("estimates.mark_as_default_estimate_template_description"):_.storeProp=="newInvoice"&&(h=n("invoices.mark_as_default_invoice_template_description")),e.openModal({title:n("general.choose_template"),componentName:"SelectTemplate",data:{templates:_.store.templates,store:_.store,storeProp:_.storeProp,isMarkAsDefault:_.isMarkAsDefault,markAsDefaultDescription:h}})}return(h,m)=>{const S=x("BaseIcon"),k=x("BaseButton");return r(),$("div",null,[a("label",hs,[A(g(h.$t("general.select_template"))+" ",1),vs]),s(k,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:I},{right:c(y=>[s(S,{name:"PencilIcon",class:G(y.class)},null,8,["class"])]),default:c(()=>[A(" "+g(t.store[t.storeProp].template_name),1)]),_:1})])}}},bs={class:"mb-6"},$s={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},ws={class:"text-gray-800 font-medium mb-4 text-sm"},Xs={__name:"CreateNotesField",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(t){const _=t;function e(n){_.store[_.storeProp].notes=""+n.notes}return(n,I)=>{const h=x("BaseCustomInput");return r(),$("div",bs,[a("div",$s,[s(Ue,{type:t.type,onSelect:e},null,8,["type"])]),a("label",ws,g(n.$t("invoices.notes")),1),s(h,{modelValue:t.store[t.storeProp].notes,"onUpdate:modelValue":I[0]||(I[0]=m=>t.store[t.storeProp].notes=m),"content-loading":t.store.isFetchingInitialSettings,fields:t.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},Bs={class:"flex justify-between w-full"},Is={class:"px-8 py-8 sm:p-6"},Ss={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},Ts=["onClick"],Ps=["src","alt"],ks=["alt","src"],Cs={key:1,class:"z-0 flex ml-3 pt-5"},Ms={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ks={__name:"SelectTemplateModal",setup(t){const _=K(),e=ne(),n=R(""),I=B(()=>_.active&&_.componentName==="SelectTemplate"),h=B(()=>_.title);function m(){_.data.store[_.data.storeProp].template_name?n.value=_.data.store[_.data.storeProp].template_name:n.value=_.data.templates[0]}async function S(){await _.data.store.setTemplate(n.value),!_.data.store.isEdit&&_.data.isMarkAsDefault&&(_.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:n.value}}):_.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:n.value}})),y()}function k(){return new URL("/build/img/tick.png",self.location)}function y(){_.closeModal(),setTimeout(()=>{_.$reset()},300)}return(C,j)=>{const q=x("BaseIcon"),i=x("BaseCheckbox"),u=x("BaseButton"),l=x("BaseModal");return r(),D(l,{show:I.value,onClose:y,onOpen:m},{header:c(()=>[a("div",Bs,[A(g(h.value)+" ",1),s(q,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:y})])]),default:c(()=>[a("div",Is,[p(_).data?(r(),$("div",Ss,[(r(!0),$(J,null,Q(p(_).data.templates,(d,v)=>(r(),$("div",{key:v,class:G([{"border border-solid border-primary-500":n.value===d.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:b=>n.value=d.name},[a("img",{src:d.path,alt:d.name,class:"w-full min-h-[100px]"},null,8,Ps),n.value===d.name?(r(),$("img",{key:0,alt:d.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:k()},null,8,ks)):E("",!0),a("span",{class:G(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":n.value===d.name,"text-gray-600":n.value!=d.name}])},g(d.name),3)],10,Ts))),128))])):E("",!0),p(_).data.store.isEdit?E("",!0):(r(),$("div",Cs,[s(i,{modelValue:p(_).data.isMarkAsDefault,"onUpdate:modelValue":j[0]||(j[0]=d=>p(_).data.isMarkAsDefault=d),"set-initial-value":!1,variant:"primary",label:C.$t("general.mark_as_default"),description:p(_).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),a("div",Ms,[s(u,{class:"mr-3",variant:"primary-outline",onClick:y},{default:c(()=>[A(g(C.$t("general.cancel")),1)]),_:1}),s(u,{variant:"primary",onClick:j[1]||(j[1]=d=>S())},{left:c(d=>[s(q,{name:"SaveIcon",class:G(d.class)},null,8,["class"])]),default:c(()=>[A(" "+g(C.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},Ds={class:"flex justify-between w-full"},Vs={class:"item-modal"},js={class:"px-8 py-8 sm:p-6"},qs={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Hs={__name:"ItemModal",emits:["newItem"],setup(t,{emit:_}){const e=K(),n=fe(),I=ee(),h=Z();Ve(),je();const{t:m}=H(),S=R(!1),k=R(I.selectedCompanySettings.tax_per_item),y=B(()=>e.active&&e.componentName==="ItemModal"),C=B({get:()=>n.currentItem.price/100,set:b=>{n.currentItem.price=Math.round(b*100)}}),j=B({get:()=>n.currentItem.taxes.map(b=>{if(b)return{...b,tax_type_id:b.id,tax_name:b.name+" ("+b.percent+"%)"}}),set:b=>{n.$patch(o=>{o.currentItem.taxes=b})}}),q=B(()=>k.value==="YES"),i={name:{required:U.withMessage(m("validation.required"),Y),minLength:U.withMessage(m("validation.name_min_length",{count:3}),qe(3))},description:{maxLength:U.withMessage(m("validation.description_maxlength",{count:255}),te(255))}},u=le(i,B(()=>n.currentItem)),l=B(()=>h.taxTypes.map(b=>({...b,tax_name:b.name+" ("+b.percent+"%)"})));_e(()=>{u.value.$reset(),n.fetchItemUnits({limit:"all"})});async function d(){if(u.value.$touch(),u.value.$invalid)return!0;let b={...n.currentItem,taxes:n.currentItem.taxes.map(w=>({tax_type_id:w.id,amount:C.value*w.percent/100,percent:w.percent,name:w.name,collective_tax:0}))};S.value=!0,await(n.isEdit?n.updateItem:n.addItem)(b).then(w=>{S.value=!1,w.data.data&&e.data&&e.refreshData(w.data.data),v()})}function v(){e.closeModal(),setTimeout(()=>{n.resetCurrentItem(),e.$reset(),u.value.$reset()},300)}return(b,o)=>{const w=x("BaseIcon"),T=x("BaseInput"),L=x("BaseInputGroup"),M=x("BaseMoney"),F=x("BaseMultiselect"),W=x("BaseTextarea"),O=x("BaseInputGrid"),f=x("BaseButton"),P=x("BaseModal");return r(),D(P,{show:y.value,onClose:v},{header:c(()=>[a("div",Ds,[A(g(p(e).title)+" ",1),s(w,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:v})])]),default:c(()=>[a("div",Vs,[a("form",{action:"",onSubmit:ge(d,["prevent"])},[a("div",js,[s(O,{layout:"one-column"},{default:c(()=>[s(L,{label:b.$t("items.name"),required:"",error:p(u).name.$error&&p(u).name.$errors[0].$message},{default:c(()=>[s(T,{modelValue:p(n).currentItem.name,"onUpdate:modelValue":o[0]||(o[0]=V=>p(n).currentItem.name=V),type:"text",invalid:p(u).name.$error,onInput:o[1]||(o[1]=V=>p(u).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),s(L,{label:b.$t("items.price")},{default:c(()=>[(r(),D(M,{key:p(I).selectedCompanyCurrency,modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=V=>C.value=V),currency:p(I).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),s(L,{label:b.$t("items.unit")},{default:c(()=>[s(F,{modelValue:p(n).currentItem.unit_id,"onUpdate:modelValue":o[3]||(o[3]=V=>p(n).currentItem.unit_id=V),label:"name",options:p(n).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:b.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),q.value?(r(),D(L,{key:0,label:b.$t("items.taxes")},{default:c(()=>[s(F,{modelValue:j.value,"onUpdate:modelValue":o[4]||(o[4]=V=>j.value=V),options:l.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):E("",!0),s(L,{label:b.$t("items.description"),error:p(u).description.$error&&p(u).description.$errors[0].$message},{default:c(()=>[s(W,{modelValue:p(n).currentItem.description,"onUpdate:modelValue":o[5]||(o[5]=V=>p(n).currentItem.description=V),rows:"4",cols:"50",invalid:p(u).description.$error,onInput:o[6]||(o[6]=V=>p(u).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),a("div",qs,[s(f,{class:"mr-3",variant:"primary-outline",type:"button",onClick:v},{default:c(()=>[A(g(b.$t("general.cancel")),1)]),_:1}),s(f,{loading:S.value,disabled:S.value,variant:"primary",type:"submit"},{left:c(V=>[s(w,{name:"SaveIcon",class:G(V.class)},null,8,["class"])]),default:c(()=>[A(" "+g(p(n).isEdit?b.$t("general.update"):b.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],32)])]),_:1},8,["show"])}}},As={class:"flex justify-between w-full"},Es={class:"flex flex-col"},Ls={class:"text-sm text-gray-500 mt-1"},Us={class:"p-4 sm:p-6"},Os={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},zs={__name:"TaxationAddressModal",emits:["addTax"],setup(t,{emit:_}){const e=K();Ae();const n=ye({state:"",city:"",address_street_1:"",zip:""}),I=R(!1),h=Z(),{t:m}=H(),S=B(()=>e.active&&e.componentName==="TaxationAddressModal"),k=B(()=>({state:{required:U.withMessage(m("validation.required"),Y)},city:{required:U.withMessage(m("validation.required"),Y)},address_street_1:{required:U.withMessage(m("validation.required"),Y)},zip:{required:U.withMessage(m("validation.required"),Y)}})),y=le(k,B(()=>n));async function C(){if(y.value.$touch(),y.value.$invalid)return!0;let u={address:n};e.id&&(u.customer_id=e.id),n.address_street_1=n.address_street_1.replace(/(\r\n|\n|\r)/gm,""),I.value=!0,await h.fetchSalesTax(u).then(l=>{I.value=!1,j("addTax",l.data.data),i()}).catch(l=>{I.value=!1})}const j=_;function q(){var u,l,d,v;n.state=(u=e==null?void 0:e.data)==null?void 0:u.state,n.city=(l=e==null?void 0:e.data)==null?void 0:l.city,n.address_street_1=(d=e==null?void 0:e.data)==null?void 0:d.address_street_1,n.zip=(v=e==null?void 0:e.data)==null?void 0:v.zip}function i(){e.closeModal()}return(u,l)=>{const d=x("BaseIcon"),v=x("BaseInput"),b=x("BaseInputGroup"),o=x("BaseTextarea"),w=x("BaseInputGrid"),T=x("BaseButton"),L=x("BaseModal");return r(),D(L,{show:S.value,onClose:i,onOpen:q},{header:c(()=>[a("div",As,[a("div",Es,[A(g(p(e).title)+" ",1),a("p",Ls,g(p(e).content),1)]),s(d,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:i})])]),default:c(()=>[a("form",{onSubmit:ge(C,["prevent"])},[a("div",Us,[s(w,{layout:"one-column"},{default:c(()=>[s(b,{required:"",error:p(y).state.$error&&p(y).state.$errors[0].$message,label:u.$t("customers.state")},{default:c(()=>[s(v,{modelValue:n.state,"onUpdate:modelValue":l[0]||(l[0]=M=>n.state=M),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:p(y).state.$error,onInput:l[1]||(l[1]=M=>p(y).state.$touch()),placeholder:u.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(b,{required:"",error:p(y).city.$error&&p(y).city.$errors[0].$message,label:u.$t("customers.city")},{default:c(()=>[s(v,{modelValue:n.city,"onUpdate:modelValue":l[2]||(l[2]=M=>n.city=M),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:p(y).city.$error,onInput:l[3]||(l[3]=M=>p(y).city.$touch()),placeholder:u.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(b,{required:"",error:p(y).address_street_1.$error&&p(y).address_street_1.$errors[0].$message,label:u.$t("customers.address")},{default:c(()=>[s(o,{modelValue:n.address_street_1,"onUpdate:modelValue":l[4]||(l[4]=M=>n.address_street_1=M),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:p(y).address_street_1.$error,onInput:l[5]||(l[5]=M=>p(y).address_street_1.$touch()),placeholder:u.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),s(b,{required:"",error:p(y).zip.$error&&p(y).zip.$errors[0].$message,label:u.$t("customers.zip_code")},{default:c(()=>[s(v,{modelValue:n.zip,"onUpdate:modelValue":l[6]||(l[6]=M=>n.zip=M),invalid:p(y).zip.$error,onInput:l[7]||(l[7]=M=>p(y).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:u.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),a("div",Os,[s(T,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:i},{default:c(()=>[A(g(u.$t("general.cancel")),1)]),_:1}),s(T,{loading:I.value,variant:"primary",type:"submit"},{left:c(M=>[I.value?E("",!0):(r(),D(d,{key:0,name:"SaveIcon",class:G(M.class)},null,8,["class"]))]),default:c(()=>[A(" "+g(u.$t("general.save")),1)]),_:1},8,["loading"])])],32)]),_:1},8,["show"])}}},se="Sales Tax",ae="MODULE",Js={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(t){const _=K(),e=ee(),n=Z(),{t:I}=H(),h=R(!1),m=t,S=B(()=>m.isEdit?m.store[m.storeProp].sales_tax_address_type==="billing":e.selectedCompanySettings.sales_tax_address_type==="billing"),k=B(()=>e.selectedCompanySettings.sales_tax_us_enabled==="YES"),y=B(()=>m.isEdit?m.store[m.storeProp].sales_tax_type==="customer_level":e.selectedCompanySettings.sales_tax_type==="customer_level"),C=B(()=>m.isEdit?m.store[m.storeProp].sales_tax_type==="company_level":e.selectedCompanySettings.sales_tax_type==="company_level"),j=B(()=>{if(y.value&&q.value){let o=S.value?m.customer.billing:m.customer.shipping;return{address:X.exports.pick(o,["address_street_1","city","state","zip"]),customer_id:m.customer.id}}else if(C.value&&q.value)return{address:X.exports.pick(address,["address_street_1","city","state","zip"])}}),q=B(()=>{var o,w;if(y.value){let T=S.value?(o=m.customer)==null?void 0:o.billing:(w=m.customer)==null?void 0:w.shipping;return i(T)}else if(C.value)return i(e.selectedCompany.address);return!1});oe(()=>m.customer,(o,w)=>{if(o&&w&&y.value){u(o,w);return}!q.value&&y.value&&o?setTimeout(()=>{l()},500):y.value&&o?d():y.value&&!o&&b()}),_e(()=>{C.value&&(q.value?d():l())});function i(o){return o?o.address_street_1&&o.city&&o.state&&o.zip:!1}function u(o,w){const T=S.value?o.billing:o.shipping,L=S.value?w.billing:w.shipping,M=X.exports.pick(T,["address_street_1","city","state","zip"]),F=X.exports.pick(L,["address_street_1","city","state","zip"]);X.exports.isEqual(M,F)||d()}function l(){var T,L;if(!k.value)return;let o=null,w="";y.value?S.value?(o=(T=m.customer)==null?void 0:T.billing,w=I("settings.taxations.add_billing_address")):(o=(L=m.customer)==null?void 0:L.shipping,w=I("settings.taxations.add_shipping_address")):(o=e.selectedCompany.address,w=I("settings.taxations.add_company_address")),_.openModal({title:w,content:I("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:o,id:y.value?m.customer.id:""})}async function d(){!k.value||(h.value=!0,await n.fetchSalesTax(j.value).then(o=>{v(o.data.data),h.value=!1}).catch(o=>{o.response.data.error&&setTimeout(()=>{l()},500),h.value=!1}))}function v(o){o.tax_type_id=o.id;const w=m.store[m.storeProp].taxes.findIndex(T=>T.name===se&&T.type===ae);w>-1?Object.assign(m.store[m.storeProp].taxes[w],o):m.store[m.storeProp].taxes.push(o)}function b(){const o=m.store[m.storeProp].taxes.findIndex(T=>T.name===se&&T.type===ae);o>-1&&m.store[m.storeProp].taxes.splice(o,1);let w=n.taxTypes.findIndex(T=>T.name===se&&T.type===ae);w>-1&&n.taxTypes.splice(w,1)}return(o,w)=>(r(),D(zs,{onAddTax:v}))}};export{Ks as _,Hs as a,Js as b,Gs as c,Xs as d,Ws as e,Rs as f};
