import{M as oe,l as se,K as Y,d as v,I as le,N as ne,e as k,E as re,P as ie,aa as de,r,o as d,c as h,a as o,h as s,x as l,R as ce,j as V,z as ue,t as g,g as _,b as n,F as A,i as me,n as fe,ah as pe}from"./main.9d5398e3.js";import{u as _e}from"./payment.116d1f14.js";import{_ as ye,a as ve}from"./SendPaymentModal.f29e77ec.js";import{L as he}from"./LoadingIcon.12d41f48.js";import"./mail-driver.baa8a379.js";const ge={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},be={class:"flex items-center justify-between px-4 pt-8 pb-6 border border-gray-200 border-solid"},xe={class:"flex ml-3",role:"group","aria-label":"First group"},Be={class:"px-4 py-1 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},ke={class:"px-2"},we={class:"px-2"},Fe={class:"px-2"},Ie={class:"flex-2"},Ve={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},Pe={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},Se={class:"flex-1 whitespace-nowrap right"},Te={class:"text-sm text-right text-gray-500 non-italic"},De={key:0,class:"flex justify-center p-4 items-center"},$e={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Le={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},ze=["src"],Ye={__name:"View",setup(Me){const y=oe(),{t:P}=se();let f=Y({}),a=Y({orderBy:null,orderByField:null,searchText:null}),b=v(!1),w=v(!1);const x=_e(),H=le(),R=ne(),c=v(null),B=v(1),S=v(1),z=v(null),O=k(()=>f.payment_number||""),M=k(()=>a.orderBy==="asc"||a.orderBy==null);k(()=>M.value?P("general.ascending"):P("general.descending"));const N=k(()=>f.unique_hash?`/payments/pdf/${f.unique_hash}`:!1);k(()=>{var e;return pe((e=x==null?void 0:x.selectedPayment)==null?void 0:e.payment_date).format("YYYY/MM/DD")}),re(y,()=>{j()}),F(),j(),m=ie.exports.debounce(m,500);function q(e){return y.params.id==e}de();async function F(e,i=!1){if(b.value)return;let u={};a.searchText!==""&&a.searchText!==null&&a.searchText!==void 0&&(u.search=a.searchText),a.orderBy!==null&&a.orderBy!==void 0&&(u.orderBy=a.orderBy),a.orderByField!==null&&a.orderByField!==void 0&&(u.orderByField=a.orderByField),b.value=!0;let I=await x.fetchPayments({page:e,...u});b.value=!1,c.value=c.value?c.value:[],c.value=[...c.value,...I.data.data],B.value=e||1,S.value=I.data.meta.last_page;let p=c.value.find(T=>T.id==y.params.id);i==!1&&!p&&B.value<S.value&&Object.keys(u).length===0&&F(++B.value),p&&setTimeout(()=>{i==!1&&G()},500)}async function j(){if(!y.params.id)return;w.value=!0;let e=await x.fetchPayment(y.params.id);e.data&&(w.value=!1,Object.assign(f,e.data.data))}function G(){const e=document.getElementById(`payment-${y.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"),K())}function K(){z.value.addEventListener("scroll",e=>{e.target.scrollTop>0&&e.target.scrollTop+e.target.clientHeight>e.target.scrollHeight-200&&B.value<S.value&&F(++B.value,!0)})}async function m(){c.value=[],F()}function J(){return a.orderBy==="asc"?(a.orderBy="desc",m(),!0):(a.orderBy="asc",m(),!0)}async function Q(){H.openModal({title:P("payments.send_payment"),componentName:"SendPaymentModal",id:f.id,data:f,variant:"lg"})}return(e,i)=>{const u=r("BaseButton"),I=r("BasePageHeader"),p=r("BaseIcon"),T=r("BaseInput"),D=r("BaseRadio"),$=r("BaseInputGroup"),L=r("BaseDropdownItem"),W=r("BaseDropdown"),X=r("BaseText"),Z=r("BaseFormatMoney"),ee=r("router-link"),te=r("BasePage");return d(),h(A,null,[o(ve),o(te,{class:"xl:pl-96"},{default:s(()=>{var C;return[o(I,{title:O.value},{actions:s(()=>[l(R).hasAbilities(l(ce).SEND_PAYMENT)?(d(),V(u,{key:0,"content-loading":l(w),variant:"primary",onClick:Q},{default:s(()=>[ue(g(e.$t("payments.send_payment_receipt")),1)]),_:1},8,["content-loading"])):_("v-if",!0),o(ye,{"content-loading":l(w),class:"ml-3",row:l(f)},null,8,["content-loading","row"])]),_:1},8,["title"]),_(" Sidebar "),n("div",ge,[n("div",be,[o(T,{modelValue:l(a).searchText,"onUpdate:modelValue":i[0]||(i[0]=t=>l(a).searchText=t),placeholder:e.$t("general.search"),type:"text",onInput:m},{default:s(()=>[o(p,{name:"SearchIcon",class:"h-5"})]),_:1},8,["modelValue","placeholder"]),n("div",xe,[o(W,{position:"bottom-start","width-class":"w-50","position-class":"left-0"},{activator:s(()=>[o(u,{variant:"gray"},{default:s(()=>[o(p,{name:"FilterIcon"})]),_:1})]),default:s(()=>[n("div",Be,g(e.$t("general.sort_by")),1),n("div",ke,[o(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:s(()=>[o($,{class:"-mt-3 font-normal"},{default:s(()=>[o(D,{id:"filter_invoice_number",modelValue:l(a).orderByField,"onUpdate:modelValue":[i[1]||(i[1]=t=>l(a).orderByField=t),m],label:e.$t("invoices.title"),size:"sm",name:"filter",value:"invoice_number"},null,8,["modelValue","label"])]),_:1})]),_:1})]),n("div",we,[o(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:s(()=>[o($,{class:"-mt-3 font-normal"},{default:s(()=>[o(D,{modelValue:l(a).orderByField,"onUpdate:modelValue":[i[2]||(i[2]=t=>l(a).orderByField=t),m],label:e.$t("payments.date"),size:"sm",name:"filter",value:"payment_date"},null,8,["modelValue","label"])]),_:1})]),_:1})]),n("div",Fe,[o(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:s(()=>[o($,{class:"-mt-3 font-normal"},{default:s(()=>[o(D,{id:"filter_payment_number",modelValue:l(a).orderByField,"onUpdate:modelValue":[i[3]||(i[3]=t=>l(a).orderByField=t),m],label:e.$t("payments.payment_number"),size:"sm",name:"filter",value:"payment_number"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),o(u,{class:"ml-1",size:"md",variant:"gray",onClick:J},{default:s(()=>[M.value?(d(),V(p,{key:0,name:"SortAscendingIcon"})):(d(),V(p,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),n("div",{ref_key:"paymentListSection",ref:z,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid"},[(d(!0),h(A,null,me(c.value,(t,ae)=>(d(),h("div",{key:ae},[t?(d(),V(ee,{key:0,id:"payment-"+t.id,to:`/admin/payments/${t.id}/view`,class:fe(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":q(t.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:s(()=>{var E,U;return[n("div",Ie,[o(X,{text:(E=t==null?void 0:t.customer)==null?void 0:E.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),n("div",Ve,g(t==null?void 0:t.payment_number),1),n("div",Pe,g(t==null?void 0:t.invoice_number),1)]),n("div",Se,[o(Z,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:t==null?void 0:t.amount,currency:(U=t.customer)==null?void 0:U.currency},null,8,["amount","currency"]),n("div",Te,g(t.formatted_payment_date),1)])]}),_:2},1032,["id","to","class"])):_("v-if",!0)]))),128)),l(b)?(d(),h("div",De,[o(he,{class:"h-6 m-1 animate-spin text-primary-400"})])):_("v-if",!0),!((C=c.value)!=null&&C.length)&&!l(b)?(d(),h("p",$e,g(e.$t("payments.no_matching_payments")),1)):_("v-if",!0)],512)]),_(" pdf "),n("div",Le,[N.value?(d(),h("iframe",{key:0,src:N.value,class:"flex-1 border border-gray-400 border-solid rounded-md"},null,8,ze)):_("v-if",!0)])]}),_:1})],64)}}};export{Ye as default};
