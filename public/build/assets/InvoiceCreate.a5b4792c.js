import{a9 as F,J as Y,r as c,o as d,c as P,a as t,x as n,h as l,H as A,ai as J,az as O,l as K,M as Q,m as W,d as k,e as I,p as _,q as B,am as X,ak as Z,Y as ee,v as ne,E as te,j as b,g as V,b as $,t as M,n as oe,z as ie,w as ae,F as se}from"./main.1a23cde4.js";import{_ as le,a as ce,b as re,c as ue,d as de,e as me,f as ve}from"./SalesTax.0dd02198.js";import{_ as ge}from"./ExchangeRateConverter.47b6088b.js";import{_ as pe}from"./CreateCustomFields.2fb65d90.js";import{_ as _e}from"./TaxTypeModal.d077a473.js";import"./DragIcon.b467d917.js";import"./SelectNotePopup.1ef401fb.js";import"./NoteModal.c3679074.js";import"./payment.1dd80eda.js";import"./exchange-rate.45e7a85f.js";const fe={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},Ie={__name:"InvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(o){const e=F(),w=Y();return(m,a)=>{const r=c("BaseCustomerSelectPopup"),f=c("BaseDatePicker"),v=c("BaseInputGroup"),u=c("BaseInput"),S=c("BaseMultiselect"),h=c("BaseInputGrid");return d(),P("div",fe,[t(r,{modelValue:n(e).newInvoice.customer,"onUpdate:modelValue":a[0]||(a[0]=i=>n(e).newInvoice.customer=i),valid:o.v.customer_id,"content-loading":o.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),t(h,{class:"col-span-12 lg:col-span-7"},{default:l(()=>[t(v,{label:m.$t("invoices.invoice_date"),"content-loading":o.isLoading,required:"",error:o.v.invoice_date.$error&&o.v.invoice_date.$errors[0].$message},{default:l(()=>[t(f,{modelValue:n(e).newInvoice.invoice_date,"onUpdate:modelValue":a[1]||(a[1]=i=>n(e).newInvoice.invoice_date=i),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(v,{label:m.$t("invoices.due_date"),"content-loading":o.isLoading},{default:l(()=>[t(f,{modelValue:n(e).newInvoice.due_date,"onUpdate:modelValue":a[2]||(a[2]=i=>n(e).newInvoice.due_date=i),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(v,{label:m.$t("invoices.invoice_number"),"content-loading":o.isLoading,error:o.v.invoice_number.$error&&o.v.invoice_number.$errors[0].$message,required:""},{default:l(()=>[t(u,{modelValue:n(e).newInvoice.invoice_number,"onUpdate:modelValue":a[3]||(a[3]=i=>n(e).newInvoice.invoice_number=i),"content-loading":o.isLoading,onInput:a[4]||(a[4]=i=>o.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(v,{label:m.$t("settings.preferences.currency"),"content-loading":o.isLoading},{default:l(()=>[t(S,{modelValue:n(e).newInvoice.currency_id,"onUpdate:modelValue":a[5]||(a[5]=i=>n(e).newInvoice.currency_id=i),"content-loading":o.isLoading,options:n(w).currencies,label:"name","value-prop":"id",searchable:!0,"track-by":"name",class:"w-full"},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"]),t(ge,{store:n(e),"store-prop":"newInvoice",v:o.v,"is-loading":o.isLoading,"is-edit":o.isEdit,"customer-currency":n(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},be={class:"flex"},we={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},ye={class:"relative w-full lg:w-1/2 lg:mr-4"},q="newInvoice",Fe={__name:"InvoiceCreate",setup(o){const e=F(),w=A(),m=J(),a=O(),{t:r}=K();let f=Q(),v=W(),u=k(!1);const S=k(!1),h=k(["customer","company","customerCustom","invoice","invoiceCustom"]);let i=I(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),E=I(()=>g.value?r("invoices.edit_invoice"):r("invoices.new_invoice"));const T=I(()=>w.selectedCompanySettings.sales_tax_us_enabled==="YES"&&a.salesTaxUSEnabled);let g=I(()=>f.name==="invoices.edit");const x={invoice_date:{required:_.withMessage(r("validation.required"),B)},reference_number:{maxLength:_.withMessage(r("validation.price_maxlength"),X(255))},customer_id:{required:_.withMessage(r("validation.required"),B)},invoice_number:{required:_.withMessage(r("validation.required"),B)},exchange_rate:{required:Z(function(){return _.withMessage(r("validation.required"),B),e.showExchangeRate}),decimal:_.withMessage(r("validation.valid_exchange_rate"),ee)}},y=ne(x,I(()=>e.newInvoice),{$scope:q});m.resetCustomFields(),y.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(g.value),te(()=>e.newInvoice.customer,s=>{s&&s.currency?e.newInvoice.selectedCurrency=s.currency:e.newInvoice.selectedCurrency=w.selectedCompanyCurrency});async function U(){if(y.value.$touch(),y.value.$invalid)return!1;u.value=!0;let s={...e.newInvoice,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};try{const p=await(g.value?e.updateInvoice:e.addInvoice)(s);v.push(`/admin/invoices/${p.data.data.id}/view`)}catch(C){console.error(C)}u.value=!1}return(s,C)=>{const p=c("BaseBreadcrumbItem"),G=c("BaseBreadcrumb"),L=c("BaseButton"),N=c("router-link"),D=c("BaseIcon"),j=c("BasePageHeader"),z=c("BaseScrollPane"),H=c("BasePage");return d(),P(se,null,[t(le),t(ce),t(_e),T.value&&(!n(i)||n(f).query.customer)?(d(),b(re,{key:0,store:n(e),"is-edit":n(g),"store-prop":"newInvoice",customer:n(e).newInvoice.customer},null,8,["store","is-edit","customer"])):V("",!0),t(H,{class:"relative invoice-create-page"},{default:l(()=>[$("form",{onSubmit:ae(U,["prevent"])},[t(j,{title:n(E)},{actions:l(()=>[s.$route.name==="invoices.edit"?(d(),b(N,{key:0,to:`/invoices/pdf/${n(e).newInvoice.unique_hash}`,target:"_blank"},{default:l(()=>[t(L,{class:"mr-3",variant:"primary-outline",type:"button"},{default:l(()=>[$("span",be,M(s.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):V("",!0),t(L,{loading:n(u),disabled:n(u),variant:"primary",type:"submit"},{left:l(R=>[n(u)?V("",!0):(d(),b(D,{key:0,name:"SaveIcon",class:oe(R.class)},null,8,["class"]))]),default:l(()=>[ie(" "+M(s.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[t(G,null,{default:l(()=>[t(p,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(p,{title:s.$tc("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),s.$route.name==="invoices.edit"?(d(),b(p,{key:0,title:s.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(d(),b(p,{key:1,title:s.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),t(Ie,{v:n(y),"is-loading":n(i),"is-edit":n(g)},null,8,["v","is-loading","is-edit"]),t(z,null,{default:l(()=>[t(ue,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(i),"item-validation-scope":q,store:n(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),$("div",we,[$("div",ye,[t(de,{store:n(e),"store-prop":"newInvoice",fields:h.value,type:"Invoice"},null,8,["store","fields"]),t(pe,{type:"Invoice","is-edit":n(g),"is-loading":n(i),store:n(e),"store-prop":"newInvoice","custom-field-scope":q,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(me,{store:n(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate","is-mark-as-default":S.value},null,8,["store","is-mark-as-default"])]),t(ve,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(i),store:n(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Fe as default};
