import{M as O,aO as P,J as Z,d as x,K as ee,e as B,E as j,f as ne,r as v,o as I,c as A,b as m,a as t,x as e,t as T,h as c,j as _,g,F as z,as as ie,H as te,ai as re,az as oe,I as ae,ae as le,u as se,l as ce,m as ue,p as y,q as p,ak as U,Y as de,v as ve,n as ge,z as me,w as fe}from"./main.9d5398e3.js";import{_ as ye,a as Ie,b as be,c as we,d as _e,e as $e,f as Re}from"./SalesTax.6eeac271.js";import{_ as qe}from"./ExchangeRateConverter.eb624777.js";import{_ as pe}from"./CreateCustomFields.60a3284d.js";import{_ as Be}from"./TaxTypeModal.b5918a39.js";import"./DragIcon.d907a151.js";import"./SelectNotePopup.eee062e2.js";import"./NoteModal.80345740.js";import"./payment.116d1f14.js";import"./exchange-rate.ef3d6f95.js";const Se={class:"col-span-5 pr-0"},Ce={class:"flex mt-7"},he={class:"relative w-20 mt-8"},Ve={class:"ml-2"},Fe={class:"p-0 mb-1 leading-snug text-left text-black"},Le={class:"p-0 m-0 text-xs leading-tight text-left text-gray-500",style:{"max-width":"480px"}},Me={class:"grid grid-cols-1 col-span-7 gap-4 mt-8 lg:gap-6 lg:mt-0 lg:grid-cols-2"},Te={__name:"RecurringInvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(n){const r=n,h=O(),i=P(),V=Z(),$=x(!1),k=ee([{label:"None",value:"NONE"},{label:"Date",value:"DATE"},{label:"Count",value:"COUNT"}]),F=B(()=>i.newRecurringInvoice.selectedFrequency&&i.newRecurringInvoice.selectedFrequency.value==="CUSTOM"),u=B(()=>r.isEdit?V.config.recurring_invoice_status.update_status:V.config.recurring_invoice_status.create_status);j(()=>i.newRecurringInvoice.selectedFrequency,a=>{i.isFetchingInitialSettings||(a&&a.value!=="CUSTOM"?i.newRecurringInvoice.frequency=a.value:i.newRecurringInvoice.frequency=null)}),ne(()=>{h.params.id||R()});function d(a){return i.newRecurringInvoice.limit_by===a}const N=ie(()=>{R()},500);async function R(){const a=i.newRecurringInvoice.frequency;if(!a)return;$.value=!0;let o={starts_at:i.newRecurringInvoice.starts_at,frequency:a};try{await i.fetchRecurringInvoiceFrequencyDate(o)}catch(S){console.error(S),$.value=!1}$.value=!1}return(a,o)=>{const S=v("BaseCustomerSelectPopup"),q=v("BaseSwitch"),C=v("BaseDatePicker"),f=v("BaseInputGroup"),b=v("BaseMultiselect"),L=v("BaseInput");return I(),A(z,null,[m("div",Se,[t(S,{modelValue:e(i).newRecurringInvoice.customer,"onUpdate:modelValue":o[0]||(o[0]=l=>e(i).newRecurringInvoice.customer=l),valid:n.v.customer_id,"content-loading":n.isLoading,type:"recurring-invoice"},null,8,["modelValue","valid","content-loading"]),m("div",Ce,[m("div",he,[t(q,{modelValue:e(i).newRecurringInvoice.send_automatically,"onUpdate:modelValue":o[1]||(o[1]=l=>e(i).newRecurringInvoice.send_automatically=l),class:"absolute -top-4"},null,8,["modelValue"])]),m("div",Ve,[m("p",Fe,T(a.$t("recurring_invoices.send_automatically")),1),m("p",Le,T(a.$t("recurring_invoices.send_automatically_desc")),1)])])]),m("div",Me,[t(f,{label:a.$t("recurring_invoices.starts_at"),"content-loading":n.isLoading,required:"",error:n.v.starts_at.$error&&n.v.starts_at.$errors[0].$message},{default:c(()=>[t(C,{modelValue:e(i).newRecurringInvoice.starts_at,"onUpdate:modelValue":o[2]||(o[2]=l=>e(i).newRecurringInvoice.starts_at=l),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:n.v.starts_at.$error,onChange:o[3]||(o[3]=l=>R())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),t(f,{label:a.$t("recurring_invoices.next_invoice_date"),"content-loading":n.isLoading,required:""},{default:c(()=>[t(C,{modelValue:e(i).newRecurringInvoice.next_invoice_at,"onUpdate:modelValue":o[4]||(o[4]=l=>e(i).newRecurringInvoice.next_invoice_at=l),"content-loading":n.isLoading,"calendar-button":!0,disabled:!0,loading:$.value,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","loading"])]),_:1},8,["label","content-loading"]),t(f,{label:a.$t("recurring_invoices.limit_by"),"content-loading":n.isLoading,class:"lg:mt-0",required:"",error:n.v.limit_by.$error&&n.v.limit_by.$errors[0].$message},{default:c(()=>[t(b,{modelValue:e(i).newRecurringInvoice.limit_by,"onUpdate:modelValue":o[5]||(o[5]=l=>e(i).newRecurringInvoice.limit_by=l),"content-loading":n.isLoading,options:k,label:"label",invalid:n.v.limit_by.$error,"value-prop":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),d("DATE")?(I(),_(f,{key:0,label:a.$t("recurring_invoices.limit_date"),"content-loading":n.isLoading,required:d("DATE"),error:n.v.limit_date.$error&&n.v.limit_date.$errors[0].$message},{default:c(()=>[t(C,{modelValue:e(i).newRecurringInvoice.limit_date,"onUpdate:modelValue":o[6]||(o[6]=l=>e(i).newRecurringInvoice.limit_date=l),"content-loading":n.isLoading,invalid:n.v.limit_date.$error,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):g("v-if",!0),d("COUNT")?(I(),_(f,{key:1,label:a.$t("recurring_invoices.count"),"content-loading":n.isLoading,required:d("COUNT"),error:n.v.limit_count.$error&&n.v.limit_count.$errors[0].$message},{default:c(()=>[t(L,{modelValue:e(i).newRecurringInvoice.limit_count,"onUpdate:modelValue":o[7]||(o[7]=l=>e(i).newRecurringInvoice.limit_count=l),"content-loading":n.isLoading,invalid:n.v.limit_count.$error,type:"number"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):g("v-if",!0),t(f,{label:a.$t("recurring_invoices.status"),required:"","content-loading":n.isLoading,error:n.v.status.$error&&n.v.status.$errors[0].$message},{default:c(()=>[t(b,{modelValue:e(i).newRecurringInvoice.status,"onUpdate:modelValue":o[8]||(o[8]=l=>e(i).newRecurringInvoice.status=l),options:u.value,"content-loading":n.isLoading,invalid:n.v.status.$error,placeholder:a.$t("recurring_invoices.select_a_status"),"value-prop":"value",label:"value"},null,8,["modelValue","options","content-loading","invalid","placeholder"])]),_:1},8,["label","content-loading","error"]),t(f,{label:a.$t("recurring_invoices.frequency.select_frequency"),required:"","content-loading":n.isLoading,error:n.v.selectedFrequency.$error&&n.v.selectedFrequency.$errors[0].$message},{default:c(()=>[t(b,{modelValue:e(i).newRecurringInvoice.selectedFrequency,"onUpdate:modelValue":o[9]||(o[9]=l=>e(i).newRecurringInvoice.selectedFrequency=l),"content-loading":n.isLoading,options:e(i).frequencies,label:"label",invalid:n.v.selectedFrequency.$error,object:"",onChange:R},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),F.value?(I(),_(f,{key:2,label:a.$t("recurring_invoices.frequency.title"),"content-loading":n.isLoading,required:"",error:n.v.frequency.$error&&n.v.frequency.$errors[0].$message},{default:c(()=>[t(L,{modelValue:e(i).newRecurringInvoice.frequency,"onUpdate:modelValue":[o[10]||(o[10]=l=>e(i).newRecurringInvoice.frequency=l),e(N)],"content-loading":n.isLoading,disabled:!F.value,invalid:n.v.frequency.$error,loading:$.value},null,8,["modelValue","content-loading","disabled","invalid","loading","onUpdate:modelValue"])]),_:1},8,["label","content-loading","error"])):g("v-if",!0),t(qe,{store:e(i),"store-prop":"newRecurringInvoice",v:n.v,"is-loading":n.isLoading,"is-edit":n.isEdit,"customer-currency":e(i).newRecurringInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])])],64)}}},ke={class:"flex"},Ne={class:"grid-cols-12 gap-8 mt-6 mb-8 lg:grid"},Ue={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},Ee={class:"w-full relative lg:w-1/2"},E="newRecurringInvoice",Je={__name:"RecurringInvoiceCreate",setup(n){const r=P(),h=te(),i=re(),V=oe(),$=ae(),k=le(),F=se(),{t:u}=ce();let d=x(!1);const N=x(["customer","company","customerCustom","invoice","invoiceCustom"]);let R=O(),a=ue(),o=B(()=>r.isFetchingInvoice||r.isFetchingInitialSettings),S=B(()=>q.value?u("recurring_invoices.edit_invoice"):u("recurring_invoices.new_invoice")),q=B(()=>R.name==="recurring-invoices.edit");const C=B(()=>h.selectedCompanySettings.sales_tax_us_enabled==="YES"&&V.salesTaxUSEnabled),f={starts_at:{required:y.withMessage(u("validation.required"),p)},status:{required:y.withMessage(u("validation.required"),p)},frequency:{required:y.withMessage(u("validation.required"),p)},limit_by:{required:y.withMessage(u("validation.required"),p)},limit_date:{required:y.withMessage(u("validation.required"),U(function(){return r.newRecurringInvoice.limit_by==="DATE"}))},limit_count:{required:y.withMessage(u("validation.required"),U(function(){return r.newRecurringInvoice.limit_by==="COUNT"}))},selectedFrequency:{required:y.withMessage(u("validation.required"),p)},customer_id:{required:y.withMessage(u("validation.required"),p)},exchange_rate:{required:U(function(){return y.withMessage(u("validation.required"),p),r.showExchangeRate}),decimal:y.withMessage(u("validation.valid_exchange_rate"),de)}},b=ve(f,B(()=>r.newRecurringInvoice),{$scope:E});r.resetCurrentRecurringInvoice(),r.fetchRecurringInvoiceInitialSettings(q.value),i.resetCustomFields(),b.value.$reset,j(()=>r.newRecurringInvoice.customer,s=>{s&&s.currency?r.newRecurringInvoice.currency=s.currency:r.newRecurringInvoice.currency=h.selectedCompanyCurrency});async function L(){if(b.value.$touch(),b.value.$invalid)return!1;d.value=!0;let s={...r.newRecurringInvoice,sub_total:r.getSubTotal,total:r.getTotal,tax:r.getTotalTax};if(s.customer&&!s.customer.email&&s.send_automatically){F.showNotification({type:"error",message:u("recurring_invoices.add_customer_email")}),l(),d.value=!1;return}R.params.id?r.updateRecurringInvoice(s).then(w=>{w.data.data&&a.push(`/admin/recurring-invoices/${w.data.data.id}/view`),d.value=!1}).catch(w=>{d.value=!1}):G(s)}async function l(){let s=r.newRecurringInvoice.customer.id;await k.fetchCustomer(s),$.openModal({title:u("customers.edit_customer"),componentName:"CustomerModal"})}function G(s){r.addRecurringInvoice(s).then(w=>{w.data.data&&a.push(`/admin/recurring-invoices/${w.data.data.id}/view`),d.value=!1}).catch(w=>{d.value=!1})}return(s,w)=>{const M=v("BaseBreadcrumbItem"),H=v("BaseBreadcrumb"),D=v("BaseButton"),Y=v("router-link"),J=v("BaseIcon"),K=v("BasePageHeader"),Q=v("BaseScrollPane"),W=v("BasePage");return I(),A(z,null,[t($e),t(Re),t(Be),C.value&&!e(o)?(I(),_(ye,{key:0,store:e(r),"store-prop":"newRecurringInvoice","is-edit":e(q),customer:e(r).newRecurringInvoice.customer},null,8,["store","is-edit","customer"])):g("v-if",!0),t(W,{class:"relative invoice-create-page"},{default:c(()=>[m("form",{onSubmit:fe(L,["prevent"])},[t(K,{title:e(S)},{actions:c(()=>[t(Y,{to:`/invoices/pdf/${e(r).newRecurringInvoice.unique_hash}`},{default:c(()=>[s.$route.name==="invoices.edit"?(I(),_(D,{key:0,target:"_blank",class:"mr-3",variant:"primary-outline",type:"button"},{default:c(()=>[m("span",ke,T(s.$t("general.view_pdf")),1)]),_:1})):g("v-if",!0)]),_:1},8,["to"]),t(D,{loading:e(d),disabled:e(d),variant:"primary",type:"submit"},{left:c(X=>[e(d)?g("v-if",!0):(I(),_(J,{key:0,name:"SaveIcon",class:ge(X.class)},null,8,["class"]))]),default:c(()=>[me(" "+T(s.$t("recurring_invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:c(()=>[t(H,null,{default:c(()=>[t(M,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(M,{title:s.$t("recurring_invoices.title",2),to:"/admin/recurring-invoices"},null,8,["title"]),s.$route.name==="invoices.edit"?(I(),_(M,{key:0,title:s.$t("recurring_invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(I(),_(M,{key:1,title:e(S),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),g(" Select Customer & Basic Fields  "),m("div",Ne,[t(Te,{v:e(b),"is-loading":e(o),"is-edit":e(q)},null,8,["v","is-loading","is-edit"])]),t(Q,null,{default:c(()=>[g(" Invoice Items "),t(Ie,{currency:e(r).newRecurringInvoice.currency,"is-loading":e(o),"item-validation-scope":E,store:e(r),"store-prop":"newRecurringInvoice"},null,8,["currency","is-loading","store"]),g(" Invoice Templates "),m("div",Ue,[m("div",Ee,[g(" Invoice Custom Notes "),t(be,{store:e(r),"store-prop":"newRecurringInvoice",fields:N.value,type:"Invoice"},null,8,["store","fields"]),g(" Invoice Custom Fields "),t(pe,{type:"Invoice","is-edit":e(q),"is-loading":e(o),store:e(r),"store-prop":"newRecurringInvoice","custom-field-scope":E,class:"mb-6"},null,8,["is-edit","is-loading","store"]),g(" Invoice Template Button"),t(we,{store:e(r),"store-prop":"newRecurringInvoice"},null,8,["store"])]),g(" Invoice Total Card "),t(_e,{currency:e(r).newRecurringInvoice.currency,"is-loading":e(o),store:e(r),"store-prop":"newRecurringInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Je as default};
