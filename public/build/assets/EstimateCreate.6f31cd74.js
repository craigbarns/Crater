import{ad as F,J as A,E as M,r,o as f,c as P,a,x as t,h as i,g as u,az as J,H as O,ai as K,l as Q,d as I,M as W,m as X,e as v,p as b,q as S,am as Z,ak as ee,Y as te,v as ae,j as E,b as h,t as q,n as se,z as ne,w as oe,F as ie}from"./main.9d5398e3.js";import{_ as le,a as re,b as me,c as de,d as ue,e as ce,f as ge}from"./SalesTax.6eeac271.js";import{_ as pe}from"./CreateCustomFields.60a3284d.js";import{_ as fe}from"./ExchangeRateConverter.eb624777.js";import{_ as _e}from"./TaxTypeModal.b5918a39.js";import{_ as be}from"./TradeInfoSection.330b9d35.js";import"./DragIcon.d907a151.js";import"./SelectNotePopup.eee062e2.js";import"./NoteModal.80345740.js";import"./payment.116d1f14.js";import"./exchange-rate.ef3d6f95.js";const ve={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},Ee={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(s){const e=F(),w=A();return M(()=>e.newEstimate.currency_id,d=>{const o=w.currencies.find(m=>m.id===d);o&&(e.newEstimate.selectedCurrency=o)}),(d,o)=>{const m=r("BaseCustomerSelectPopup"),g=r("BaseDatePicker"),p=r("BaseInputGroup"),y=r("BaseInput"),B=r("BaseMultiselect"),C=r("BaseInputGrid");return f(),P("div",ve,[a(m,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":o[0]||(o[0]=n=>t(e).newEstimate.customer=n),valid:s.v.customer_id,"content-loading":s.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(C,{class:"col-span-7"},{default:i(()=>[a(p,{label:d.$t("reports.estimates.estimate_date"),"content-loading":s.isLoading,required:"",error:s.v.estimate_date.$error&&s.v.estimate_date.$errors[0].$message},{default:i(()=>[a(g,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":o[1]||(o[1]=n=>t(e).newEstimate.estimate_date=n),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(p,{label:d.$t("estimates.expiry_date"),"content-loading":s.isLoading},{default:i(()=>[a(g,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":o[2]||(o[2]=n=>t(e).newEstimate.expiry_date=n),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(p,{label:d.$t("estimates.estimate_number"),"content-loading":s.isLoading,required:"",error:s.v.estimate_number.$error&&s.v.estimate_number.$errors[0].$message},{default:i(()=>[a(y,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":o[3]||(o[3]=n=>t(e).newEstimate.estimate_number=n),"content-loading":s.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),u(` <BaseInputGroup
        :label="$t('estimates.ref_number')"
        :content-loading="isLoading"
        :error="
          v.reference_number.$error && v.reference_number.$errors[0].$message
        "
      >
        <BaseInput
          v-model="estimateStore.newEstimate.reference_number"
          :content-loading="isLoading"
          @input="v.reference_number.$touch()"
        >
          <template #left="slotProps">
            <BaseIcon name="HashtagIcon" :class="slotProps.class" />
          </template>
        </BaseInput>
      </BaseInputGroup> `),a(p,{label:d.$t("settings.preferences.currency"),"content-loading":s.isLoading},{default:i(()=>[a(B,{modelValue:t(e).newEstimate.currency_id,"onUpdate:modelValue":o[4]||(o[4]=n=>t(e).newEstimate.currency_id=n),"content-loading":s.isLoading,options:t(w).currencies,label:"name","value-prop":"id",searchable:!0,"track-by":"name",class:"w-full"},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"]),a(fe,{store:t(e),"store-prop":"newEstimate",v:s.v,"is-loading":s.isLoading,"is-edit":s.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"]),a(p,{label:d.$t("trade.contract_number"),"content-loading":s.isLoading},{default:i(()=>[a(y,{modelValue:t(e).newEstimate.contract_number,"onUpdate:modelValue":o[5]||(o[5]=n=>t(e).newEstimate.contract_number=n),"content-loading":s.isLoading,placeholder:d.$t("trade.contract_number_placeholder")},null,8,["modelValue","content-loading","placeholder"])]),_:1},8,["label","content-loading"])]),_:1})])}}},we={class:"flex"},ye={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},Be={class:"relative w-full lg:w-1/2"},V="newEstimate",Pe={__name:"EstimateCreate",setup(s){const e=F(),w=J(),d=O(),o=K(),{t:m}=Q();let g=I(!1);const p=I(!1),y=I(["customer","company","customerCustom","estimate","estimateCustom"]);let B=W(),C=X(),n=v(()=>e.isFetchingInitialSettings),x=v(()=>_.value?m("estimates.edit_estimate"):m("estimates.new_estimate")),_=v(()=>B.name==="estimates.edit");const T=v(()=>d.selectedCompanySettings.sales_tax_us_enabled==="YES"&&w.salesTaxUSEnabled),G={estimate_date:{required:b.withMessage(m("validation.required"),S)},estimate_number:{required:b.withMessage(m("validation.required"),S)},reference_number:{maxLength:b.withMessage(m("validation.price_maxlength"),Z(255))},customer_id:{required:b.withMessage(m("validation.required"),S)},exchange_rate:{required:ee(function(){return b.withMessage(m("validation.required"),S),e.showExchangeRate}),decimal:b.withMessage(m("validation.valid_exchange_rate"),te)}},$=ae(G,v(()=>e.newEstimate),{$scope:V});M(()=>e.newEstimate.customer,l=>{l&&l.currency?e.newEstimate.selectedCurrency=l.currency:e.newEstimate.selectedCurrency=d.selectedCompanyCurrency}),e.resetCurrentEstimate(),o.resetCustomFields(),$.value.$reset,e.fetchEstimateInitialSettings(_.value);async function U(){if($.value.$touch(),$.value.$invalid)return!1;g.value=!0;let l={...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};const k=_.value?e.updateEstimate:e.addEstimate;try{let c=await k(l);c.data.data&&C.push(`/admin/estimates/${c.data.data.id}/view`)}catch(c){console.error(c)}g.value=!1}return(l,k)=>{const c=r("BaseBreadcrumbItem"),N=r("BaseBreadcrumb"),L=r("BaseButton"),D=r("router-link"),H=r("BaseIcon"),j=r("BasePageHeader"),z=r("BaseScrollPane"),R=r("BasePage");return f(),P(ie,null,[a(ce),a(ge),a(_e),T.value&&(!t(n)||t(B).query.customer)?(f(),E(le,{key:0,store:t(e),"store-prop":"newEstimate","is-edit":t(_),customer:t(e).newEstimate.customer},null,8,["store","is-edit","customer"])):u("v-if",!0),a(R,{class:"relative estimate-create-page"},{default:i(()=>[h("form",{onSubmit:oe(U,["prevent"])},[a(j,{title:t(x)},{actions:i(()=>[l.$route.name==="estimates.edit"?(f(),E(D,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:i(()=>[a(L,{class:"mr-3",variant:"primary-outline",type:"button"},{default:i(()=>[h("span",we,q(l.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):u("v-if",!0),a(L,{loading:t(g),disabled:t(g),"content-loading":t(n),variant:"primary",type:"submit"},{left:i(Y=>[t(g)?u("v-if",!0):(f(),E(H,{key:0,class:se(Y.class),name:"SaveIcon"},null,8,["class"]))]),default:i(()=>[ne(" "+q(l.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:i(()=>[a(N,null,{default:i(()=>[a(c,{title:l.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(c,{title:l.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),l.$route.name==="estimates.edit"?(f(),E(c,{key:0,title:l.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(f(),E(c,{key:1,title:l.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),u(" Select Customer & Basic Fields  "),a(Ee,{v:t($),"is-loading":t(n),"is-edit":t(_)},null,8,["v","is-loading","is-edit"]),u(" Trade / Export Information "),a(be,{store:t(e),"store-prop":"newEstimate","is-loading":t(n),"show-bl-awb":!1},null,8,["store","is-loading"]),a(z,null,{default:i(()=>[u(" Estimate Items "),a(re,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(n),"item-validation-scope":V,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),u(" Estimate Footer Section "),h("div",ye,[h("div",Be,[u(" Estimate Custom Notes "),a(me,{store:t(e),"store-prop":"newEstimate",fields:y.value,type:"Estimate"},null,8,["store","fields"]),u(" Estimate Custom Fields "),a(pe,{type:"Estimate","is-edit":t(_),"is-loading":t(n),store:t(e),"store-prop":"newEstimate","custom-field-scope":V,class:"mb-6"},null,8,["is-edit","is-loading","store"]),u(" Estimate Template Button"),a(de,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":p.value},null,8,["store","is-mark-as-default"])]),a(ue,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(n),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Pe as default};
