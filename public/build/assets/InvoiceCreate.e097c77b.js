import{a9 as F,J as A,E as P,r as c,o as m,c as E,a as t,x as n,h as l,H as J,ai as O,az as K,l as Q,M as W,m as X,d as k,e as b,p as f,q as B,am as Z,ak as ee,Y as ne,v as te,j as w,g as V,b as $,t as M,n as oe,z as ie,w as ae,F as se}from"./main.fbeb8997.js";import{_ as le,a as ce,b as re,c as ue,d as de,e as me,f as ve}from"./SalesTax.937699f2.js";import{_ as ge}from"./ExchangeRateConverter.8a5d180d.js";import{_ as pe}from"./CreateCustomFields.01100cce.js";import{_ as fe}from"./TaxTypeModal.cf1cd800.js";import"./DragIcon.020af5b8.js";import"./SelectNotePopup.df287278.js";import"./NoteModal.481c8182.js";import"./payment.869afd98.js";import"./exchange-rate.38fc72ca.js";const _e={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},Ie={__name:"InvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(o){const e=F(),_=A();return P(()=>e.newInvoice.currency_id,u=>{const i=_.currencies.find(r=>r.id===u);i&&(e.newInvoice.selectedCurrency=i)}),(u,i)=>{const r=c("BaseCustomerSelectPopup"),I=c("BaseDatePicker"),v=c("BaseInputGroup"),d=c("BaseInput"),S=c("BaseMultiselect"),h=c("BaseInputGrid");return m(),E("div",_e,[t(r,{modelValue:n(e).newInvoice.customer,"onUpdate:modelValue":i[0]||(i[0]=a=>n(e).newInvoice.customer=a),valid:o.v.customer_id,"content-loading":o.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),t(h,{class:"col-span-12 lg:col-span-7"},{default:l(()=>[t(v,{label:u.$t("invoices.invoice_date"),"content-loading":o.isLoading,required:"",error:o.v.invoice_date.$error&&o.v.invoice_date.$errors[0].$message},{default:l(()=>[t(I,{modelValue:n(e).newInvoice.invoice_date,"onUpdate:modelValue":i[1]||(i[1]=a=>n(e).newInvoice.invoice_date=a),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(v,{label:u.$t("invoices.due_date"),"content-loading":o.isLoading},{default:l(()=>[t(I,{modelValue:n(e).newInvoice.due_date,"onUpdate:modelValue":i[2]||(i[2]=a=>n(e).newInvoice.due_date=a),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(v,{label:u.$t("invoices.invoice_number"),"content-loading":o.isLoading,error:o.v.invoice_number.$error&&o.v.invoice_number.$errors[0].$message,required:""},{default:l(()=>[t(d,{modelValue:n(e).newInvoice.invoice_number,"onUpdate:modelValue":i[3]||(i[3]=a=>n(e).newInvoice.invoice_number=a),"content-loading":o.isLoading,onInput:i[4]||(i[4]=a=>o.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(v,{label:u.$t("settings.preferences.currency"),"content-loading":o.isLoading},{default:l(()=>[t(S,{modelValue:n(e).newInvoice.currency_id,"onUpdate:modelValue":i[5]||(i[5]=a=>n(e).newInvoice.currency_id=a),"content-loading":o.isLoading,options:n(_).currencies,label:"name","value-prop":"id",searchable:!0,"track-by":"name",class:"w-full"},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"]),t(ge,{store:n(e),"store-prop":"newInvoice",v:o.v,"is-loading":o.isLoading,"is-edit":o.isEdit,"customer-currency":n(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},be={class:"flex"},we={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},ye={class:"relative w-full lg:w-1/2 lg:mr-4"},q="newInvoice",Fe={__name:"InvoiceCreate",setup(o){const e=F(),_=J(),u=O(),i=K(),{t:r}=Q();let I=W(),v=X(),d=k(!1);const S=k(!1),h=k(["customer","company","customerCustom","invoice","invoiceCustom"]);let a=b(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),T=b(()=>g.value?r("invoices.edit_invoice"):r("invoices.new_invoice"));const x=b(()=>_.selectedCompanySettings.sales_tax_us_enabled==="YES"&&i.salesTaxUSEnabled);let g=b(()=>I.name==="invoices.edit");const U={invoice_date:{required:f.withMessage(r("validation.required"),B)},reference_number:{maxLength:f.withMessage(r("validation.price_maxlength"),Z(255))},customer_id:{required:f.withMessage(r("validation.required"),B)},invoice_number:{required:f.withMessage(r("validation.required"),B)},exchange_rate:{required:ee(function(){return f.withMessage(r("validation.required"),B),e.showExchangeRate}),decimal:f.withMessage(r("validation.valid_exchange_rate"),ne)}},y=te(U,b(()=>e.newInvoice),{$scope:q});u.resetCustomFields(),y.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(g.value),P(()=>e.newInvoice.customer,s=>{s&&s.currency?e.newInvoice.selectedCurrency=s.currency:e.newInvoice.selectedCurrency=_.selectedCompanyCurrency});async function G(){if(y.value.$touch(),y.value.$invalid)return!1;d.value=!0;let s={...e.newInvoice,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};try{const p=await(g.value?e.updateInvoice:e.addInvoice)(s);v.push(`/admin/invoices/${p.data.data.id}/view`)}catch(C){console.error(C)}d.value=!1}return(s,C)=>{const p=c("BaseBreadcrumbItem"),N=c("BaseBreadcrumb"),L=c("BaseButton"),D=c("router-link"),j=c("BaseIcon"),z=c("BasePageHeader"),H=c("BaseScrollPane"),R=c("BasePage");return m(),E(se,null,[t(le),t(ce),t(fe),x.value&&(!n(a)||n(I).query.customer)?(m(),w(re,{key:0,store:n(e),"is-edit":n(g),"store-prop":"newInvoice",customer:n(e).newInvoice.customer},null,8,["store","is-edit","customer"])):V("",!0),t(R,{class:"relative invoice-create-page"},{default:l(()=>[$("form",{onSubmit:ae(G,["prevent"])},[t(z,{title:n(T)},{actions:l(()=>[s.$route.name==="invoices.edit"?(m(),w(D,{key:0,to:`/invoices/pdf/${n(e).newInvoice.unique_hash}`,target:"_blank"},{default:l(()=>[t(L,{class:"mr-3",variant:"primary-outline",type:"button"},{default:l(()=>[$("span",be,M(s.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):V("",!0),t(L,{loading:n(d),disabled:n(d),variant:"primary",type:"submit"},{left:l(Y=>[n(d)?V("",!0):(m(),w(j,{key:0,name:"SaveIcon",class:oe(Y.class)},null,8,["class"]))]),default:l(()=>[ie(" "+M(s.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[t(N,null,{default:l(()=>[t(p,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(p,{title:s.$tc("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),s.$route.name==="invoices.edit"?(m(),w(p,{key:0,title:s.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(m(),w(p,{key:1,title:s.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),t(Ie,{v:n(y),"is-loading":n(a),"is-edit":n(g)},null,8,["v","is-loading","is-edit"]),t(H,null,{default:l(()=>[t(ue,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(a),"item-validation-scope":q,store:n(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),$("div",we,[$("div",ye,[t(de,{store:n(e),"store-prop":"newInvoice",fields:h.value,type:"Invoice"},null,8,["store","fields"]),t(pe,{type:"Invoice","is-edit":n(g),"is-loading":n(a),store:n(e),"store-prop":"newInvoice","custom-field-scope":q,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(me,{store:n(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate","is-mark-as-default":S.value},null,8,["store","is-mark-as-default"])]),t(ve,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(a),store:n(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Fe as default};
