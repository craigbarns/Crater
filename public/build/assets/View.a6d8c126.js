import{ae as M,M as N,l as Y,d as F,K as L,P as ee,e as E,r as d,o as n,c as b,b as o,a as e,h as l,x as a,t as x,j as _,F as G,i as X,g as u,n as q,z as V,_ as te,H as se,a5 as K,E as ae,y as le,aa as ne,N as oe,m as re,R as S}from"./main.9d5398e3.js";import{L as ie}from"./LoadingIcon.12d41f48.js";import{_ as ce}from"./LineChart.cf13a1b1.js";import{_ as de}from"./CustomerIndexDropdown.949ba89b.js";const ue={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},me={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},_e={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},pe={class:"px-4 py-3 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},fe={class:"px-2"},he={class:"px-2"},ye={class:"flex-1 font-bold text-right whitespace-nowrap"},ve={key:0,class:"flex justify-center p-4 items-center"},ge={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},xe={__name:"CustomerViewSidebar",setup(j){const T=M(),t=N(),{t:m}=Y();let r=F(!1),s=L({orderBy:null,orderByField:null,searchText:null});const p=F(null),h=F(1),y=F(1),I=F(null);c=ee.exports.debounce(c,500);const f=E(()=>s.orderBy==="asc"||s.orderBy==null);E(()=>f.value?m("general.ascending"):m("general.descending"));function B(i){return t.params.id==i}async function v(i,w=!1){if(r.value)return;let C={};s.searchText!==""&&s.searchText!==null&&s.searchText!==void 0&&(C.display_name=s.searchText),s.orderBy!==null&&s.orderBy!==void 0&&(C.orderBy=s.orderBy),s.orderByField!==null&&s.orderByField!==void 0&&(C.orderByField=s.orderByField),r.value=!0;let P=await T.fetchCustomers({page:i,...C,limit:15});r.value=!1,p.value=p.value?p.value:[],p.value=[...p.value,...P.data.data],h.value=i||1,y.value=P.data.meta.last_page;let A=p.value.find(R=>R.id==t.params.id);w==!1&&!A&&h.value<y.value&&Object.keys(C).length===0&&v(++h.value),A&&setTimeout(()=>{w==!1&&$()},500)}function $(){const i=document.getElementById(`customer-${t.params.id}`);i&&(i.scrollIntoView({behavior:"smooth"}),i.classList.add("shake"),D())}function D(){I.value.addEventListener("scroll",i=>{i.target.scrollTop>0&&i.target.scrollTop+i.target.clientHeight>i.target.scrollHeight-200&&h.value<y.value&&v(++h.value,!0)})}async function c(){p.value=[],v()}function k(){return s.orderBy==="asc"?(s.orderBy="desc",c(),!0):(s.orderBy="asc",c(),!0)}return v(),(i,w)=>{var H;const C=d("BaseIcon"),P=d("BaseInput"),A=d("BaseButton"),R=d("BaseRadio"),O=d("BaseInputGroup"),U=d("BaseDropdownItem"),J=d("BaseDropdown"),z=d("BaseText"),Q=d("BaseFormatMoney"),W=d("router-link");return n(),b("div",ue,[o("div",me,[e(P,{modelValue:a(s).searchText,"onUpdate:modelValue":w[0]||(w[0]=g=>a(s).searchText=g),placeholder:i.$t("general.search"),"container-class":"mb-6",type:"text",variant:"gray",onInput:w[1]||(w[1]=g=>c())},{default:l(()=>[e(C,{name:"SearchIcon",class:"text-gray-500"})]),_:1},8,["modelValue","placeholder"]),o("div",_e,[e(J,{"close-on-select":!1,position:"bottom-start","width-class":"w-40","position-class":"left-0"},{activator:l(()=>[e(A,{variant:"gray"},{default:l(()=>[e(C,{name:"FilterIcon"})]),_:1})]),default:l(()=>[o("div",pe,x(i.$t("general.sort_by")),1),o("div",fe,[e(U,{class:"flex px-1 py-2 mt-1 cursor-pointer hover:rounded-md"},{default:l(()=>[e(O,{class:"pt-2 -mt-4"},{default:l(()=>[e(R,{id:"filter_create_date",modelValue:a(s).orderByField,"onUpdate:modelValue":[w[2]||(w[2]=g=>a(s).orderByField=g),c],label:i.$t("customers.create_date"),size:"sm",name:"filter",value:"invoices.created_at"},null,8,["modelValue","label"])]),_:1})]),_:1})]),o("div",he,[e(U,{class:"flex px-1 cursor-pointer hover:rounded-md"},{default:l(()=>[e(O,{class:"pt-2 -mt-4"},{default:l(()=>[e(R,{id:"filter_display_name",modelValue:a(s).orderByField,"onUpdate:modelValue":[w[3]||(w[3]=g=>a(s).orderByField=g),c],label:i.$t("customers.display_name"),size:"sm",name:"filter",value:"name"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),e(A,{class:"ml-1",size:"md",variant:"gray",onClick:k},{default:l(()=>[f.value?(n(),_(C,{key:0,name:"SortAscendingIcon"})):(n(),_(C,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),o("div",{ref_key:"customerListSection",ref:I,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid sidebar base-scroll"},[(n(!0),b(G,null,X(p.value,(g,Z)=>(n(),b("div",{key:Z},[g?(n(),_(W,{key:0,id:"customer-"+g.id,to:`/admin/customers/${g.id}/view`,class:q(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":B(g.id)}]),style:{"border-top":"1px solid rgba(185, 193, 209, 0.41)"}},{default:l(()=>[o("div",null,[e(z,{text:g.name,length:30,class:"pr-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),g.contact_name?(n(),_(z,{key:0,text:g.contact_name,length:30,class:"mt-1 text-xs not-italic font-medium leading-5 text-gray-600"},null,8,["text"])):u("v-if",!0)]),o("div",ye,[e(Q,{amount:g.due_amount!==null?g.due_amount:0,currency:g.currency},null,8,["amount","currency"])])]),_:2},1032,["id","to","class"])):u("v-if",!0)]))),128)),a(r)?(n(),b("div",ve,[e(ie,{class:"h-6 m-1 animate-spin text-primary-400"})])):u("v-if",!0),!((H=p.value)!=null&&H.length)&&!a(r)?(n(),b("p",ge,x(i.$t("customers.no_matching_customers")),1)):u("v-if",!0)],512)])}}},be={class:"pt-6 mt-5 border-t border-solid lg:pt-8 md:pt-4 border-gray-200"},Be={key:0,class:"text-sm font-bold leading-5 text-black non-italic"},$e={key:0},we={key:1},Ce={key:1,class:"text-sm font-bold leading-5 text-black non-italic"},Te={__name:"CustomerInfo",setup(j){const T=M(),t=E(()=>T.selectedViewCustomer),m=E(()=>T.isFetchingViewData),r=E(()=>{var s,p;return(s=t==null?void 0:t.value)!=null&&s.fields?(p=t==null?void 0:t.value)==null?void 0:p.fields:[]});return(s,p)=>{const h=d("BaseHeading"),y=d("BaseDescriptionListItem"),I=d("BaseDescriptionList"),f=d("BaseCustomerAddressDisplay");return n(),b("div",be,[u(" Basic Info "),e(h,null,{default:l(()=>[V(x(s.$t("customers.basic_info")),1)]),_:1}),e(I,null,{default:l(()=>{var B,v,$;return[e(y,{"content-loading":m.value,label:s.$t("customers.display_name"),value:(B=t.value)==null?void 0:B.name},null,8,["content-loading","label","value"]),e(y,{"content-loading":m.value,label:s.$t("customers.primary_contact_name"),value:(v=t.value)==null?void 0:v.contact_name},null,8,["content-loading","label","value"]),e(y,{"content-loading":m.value,label:s.$t("customers.email"),value:($=t.value)==null?void 0:$.email},null,8,["content-loading","label","value"])]}),_:1}),e(I,{class:"mt-5"},{default:l(()=>{var B,v,$,D,c,k,i;return[e(y,{"content-loading":m.value,label:s.$t("wizard.currency"),value:(B=t.value)!=null&&B.currency?`${($=(v=t.value)==null?void 0:v.currency)==null?void 0:$.code} (${(c=(D=t.value)==null?void 0:D.currency)==null?void 0:c.symbol})`:""},null,8,["content-loading","label","value"]),e(y,{"content-loading":m.value,label:s.$t("customers.phone_number"),value:(k=t.value)==null?void 0:k.phone},null,8,["content-loading","label","value"]),e(y,{"content-loading":m.value,label:s.$t("customers.website"),value:(i=t.value)==null?void 0:i.website},null,8,["content-loading","label","value"])]}),_:1}),u(" Address "),t.value.billing||t.value.shipping?(n(),_(h,{key:0,class:"mt-8"},{default:l(()=>[V(x(s.$t("customers.address")),1)]),_:1})):u("v-if",!0),e(I,{class:"mt-5"},{default:l(()=>[t.value.billing?(n(),_(y,{key:0,"content-loading":m.value,label:s.$t("customers.billing_address")},{default:l(()=>[e(f,{address:t.value.billing},null,8,["address"])]),_:1},8,["content-loading","label"])):u("v-if",!0),t.value.shipping?(n(),_(y,{key:1,"content-loading":m.value,label:s.$t("customers.shipping_address")},{default:l(()=>[e(f,{address:t.value.shipping},null,8,["address"])]),_:1},8,["content-loading","label"])):u("v-if",!0)]),_:1}),u(" Custom Fields "),r.value.length>0?(n(),_(h,{key:1,class:"mt-8"},{default:l(()=>[V(x(s.$t("settings.custom_fields.title")),1)]),_:1})):u("v-if",!0),e(I,{class:"mt-5"},{default:l(()=>[(n(!0),b(G,null,X(r.value,(B,v)=>(n(),_(y,{key:v,"content-loading":m.value,label:B.custom_field.label},{default:l(()=>[B.type==="Switch"?(n(),b("p",Be,[B.default_answer===1?(n(),b("span",$e," Yes ")):(n(),b("span",we," No "))])):(n(),b("p",Ce,x(B.default_answer),1))]),_:2},1032,["content-loading","label"]))),128))]),_:1})])}}},ke={},Ee={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Ie={class:"flex justify-between mt-1 mb-6"},De={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},Se={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ve={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ae={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Fe={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"};function Pe(j,T){const t=d("BaseContentPlaceholdersText"),m=d("BaseContentPlaceholdersBox"),r=d("BaseContentPlaceholders");return n(),_(r,{class:"grid grid-cols-12"},{default:l(()=>[o("div",Ee,[o("div",Ie,[e(t,{class:"h-10 w-36",lines:1}),e(t,{class:"h-10 w-40 !mt-0",lines:1})]),e(m,{class:"h-80 xl:h-72 sm:w-full"})]),o("div",De,[o("div",Se,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),o("div",Ve,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),o("div",Ae,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),o("div",Fe,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})])])]),_:1})}var je=te(ke,[["render",Pe]]);const Re={key:1,class:"grid grid-cols-12"},Le={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Me={class:"flex justify-between mt-1 mb-6"},Ne={class:"flex items-center"},Oe={class:"w-40 h-10"},Ue={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},ze={class:"px-6 py-2"},He={class:"text-xs leading-5 lg:text-sm"},Ye=o("br",null,null,-1),Ge={key:0,class:"block mt-1 text-xl font-semibold leading-8"},Xe={class:"px-6 py-2"},qe={class:"text-xs leading-5 lg:text-sm"},Ke=o("br",null,null,-1),Je={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#00c99c"}},Qe={class:"px-6 py-2"},We={class:"text-xs leading-5 lg:text-sm"},Ze=o("br",null,null,-1),et={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#fb7178"}},tt={class:"px-6 py-2"},st={class:"text-xs leading-5 lg:text-sm"},at=o("br",null,null,-1),lt={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#5851d8"}},nt={__name:"CustomerChart",setup(j){se();const T=M();K("utils");const t=N();let m=F(!1),r=L({}),s=L({}),p=L(["This year","Previous year"]),h=F("This year");const y=E(()=>r.expenseTotals?r.expenseTotals:[]),I=E(()=>r.netProfits?r.netProfits:[]),f=E(()=>r&&r.months?r.months:[]),B=E(()=>r.receiptTotals?r.receiptTotals:[]),v=E(()=>r.invoiceTotals?r.invoiceTotals:[]);ae(t,()=>{t.params.id&&$(),h.value="This year"},{immediate:!0});async function $(){m.value=!1;let c=await T.fetchViewCustomer({id:t.params.id});c.data&&(Object.assign(r,c.data.meta.chartData),Object.assign(s,c.data.data)),m.value=!0}async function D(c){let k={id:t.params.id};c==="Previous year"?k.previous_year=!0:k.this_year=!0;let i=await T.fetchViewCustomer(k);return i.data.meta.chartData&&Object.assign(r,i.data.meta.chartData),!0}return(c,k)=>{const i=d("BaseIcon"),w=d("BaseMultiselect"),C=d("BaseFormatMoney"),P=d("BaseCard");return n(),_(P,{class:"flex flex-col mt-6"},{default:l(()=>[a(T).isFetchingViewData?(n(),_(je,{key:0})):(n(),b("div",Re,[o("div",Le,[o("div",Me,[o("h6",Ne,[e(i,{name:"ChartSquareBarIcon",class:"h-5 text-primary-400"}),V(" "+x(c.$t("dashboard.monthly_chart.title")),1)]),o("div",Oe,[e(w,{modelValue:a(h),"onUpdate:modelValue":k[0]||(k[0]=A=>le(h)?h.value=A:h=A),options:a(p),"allow-empty":!1,"show-labels":!1,placeholder:c.$t("dashboard.select_year"),"can-deselect":!1,onSelect:D},null,8,["modelValue","options","placeholder"])])]),a(m)?(n(),_(ce,{key:0,invoices:v.value,expenses:y.value,receipts:B.value,income:I.value,labels:f.value,class:"sm:w-full"},null,8,["invoices","expenses","receipts","income","labels"])):u("v-if",!0)]),o("div",Ue,[o("div",ze,[o("span",He,x(c.$t("dashboard.chart_info.total_sales")),1),Ye,a(m)?(n(),b("span",Ge,[e(C,{amount:a(r).salesTotal,currency:a(s).currency},null,8,["amount","currency"])])):u("v-if",!0)]),o("div",Xe,[o("span",qe,x(c.$t("dashboard.chart_info.total_receipts")),1),Ke,a(m)?(n(),b("span",Je,[e(C,{amount:a(r).totalExpenses,currency:a(s).currency},null,8,["amount","currency"])])):u("v-if",!0)]),o("div",Qe,[o("span",We,x(c.$t("dashboard.chart_info.total_expense")),1),Ze,a(m)?(n(),b("span",et,[e(C,{amount:a(r).totalExpenses,currency:a(s).currency},null,8,["amount","currency"])])):u("v-if",!0)]),o("div",tt,[o("span",st,x(c.$t("dashboard.chart_info.net_income")),1),at,a(m)?(n(),b("span",lt,[e(C,{amount:a(r).netProfit,currency:a(s).currency},null,8,["amount","currency"])])):u("v-if",!0)])])])),e(Te)]),_:1})}}},dt={__name:"View",setup(j){K("utils"),ne();const T=M(),t=oe();Y();const m=re(),r=N();F(null);const s=E(()=>T.selectedViewCustomer.customer?T.selectedViewCustomer.customer.name:"");let p=E(()=>T.isFetchingViewData);function h(){return t.hasAbilities([S.CREATE_ESTIMATE,S.CREATE_INVOICE,S.CREATE_PAYMENT,S.CREATE_EXPENSE])}function y(){return t.hasAbilities([S.DELETE_CUSTOMER,S.EDIT_CUSTOMER])}function I(){m.push("/admin/customers")}return(f,B)=>{const v=d("BaseButton"),$=d("router-link"),D=d("BaseIcon"),c=d("BaseDropdownItem"),k=d("BaseDropdown"),i=d("BasePageHeader"),w=d("BasePage");return n(),_(w,{class:"xl:pl-96"},{default:l(()=>[e(i,{title:s.value},{actions:l(()=>[a(t).hasAbilities(a(S).EDIT_CUSTOMER)?(n(),_($,{key:0,to:`/admin/customers/${a(r).params.id}/edit`},{default:l(()=>[e(v,{class:"mr-3",variant:"primary-outline","content-loading":a(p)},{default:l(()=>[V(x(f.$t("general.edit")),1)]),_:1},8,["content-loading"])]),_:1},8,["to"])):u("v-if",!0),h()?(n(),_(k,{key:1,position:"bottom-end","content-loading":a(p)},{activator:l(()=>[e(v,{class:"mr-3",variant:"primary","content-loading":a(p)},{default:l(()=>[V(x(f.$t("customers.new_transaction")),1)]),_:1},8,["content-loading"])]),default:l(()=>[a(t).hasAbilities(a(S).CREATE_ESTIMATE)?(n(),_($,{key:0,to:`/admin/estimates/create?customer=${f.$route.params.id}`},{default:l(()=>[e(c,{class:""},{default:l(()=>[e(D,{name:"DocumentIcon",class:"mr-3 text-gray-600"}),V(" "+x(f.$t("estimates.new_estimate")),1)]),_:1})]),_:1},8,["to"])):u("v-if",!0),a(t).hasAbilities(a(S).CREATE_INVOICE)?(n(),_($,{key:1,to:`/admin/invoices/create?customer=${f.$route.params.id}`},{default:l(()=>[e(c,null,{default:l(()=>[e(D,{name:"DocumentTextIcon",class:"mr-3 text-gray-600"}),V(" "+x(f.$t("invoices.new_invoice")),1)]),_:1})]),_:1},8,["to"])):u("v-if",!0),a(t).hasAbilities(a(S).CREATE_PAYMENT)?(n(),_($,{key:2,to:`/admin/payments/create?customer=${f.$route.params.id}`},{default:l(()=>[e(c,null,{default:l(()=>[e(D,{name:"CreditCardIcon",class:"mr-3 text-gray-600"}),V(" "+x(f.$t("payments.new_payment")),1)]),_:1})]),_:1},8,["to"])):u("v-if",!0),a(t).hasAbilities(a(S).CREATE_EXPENSE)?(n(),_($,{key:3,to:`/admin/expenses/create?customer=${f.$route.params.id}`},{default:l(()=>[e(c,null,{default:l(()=>[e(D,{name:"CalculatorIcon",class:"mr-3 text-gray-600"}),V(" "+x(f.$t("expenses.new_expense")),1)]),_:1})]),_:1},8,["to"])):u("v-if",!0)]),_:1},8,["content-loading"])):u("v-if",!0),y()?(n(),_(de,{key:2,class:q({"ml-3":a(p)}),row:a(T).selectedViewCustomer,"load-data":I},null,8,["class","row"])):u("v-if",!0)]),_:1},8,["title"]),u(" Customer View Sidebar "),e(xe),u(" Chart "),e(nt)]),_:1})}}};export{dt as default};
