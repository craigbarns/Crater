import{ad as M,J as A,E as x,r,o as p,c as P,a,x as t,h as o,az as J,H as O,ai as K,l as Q,d as C,M as W,m as X,e as b,p as _,q as B,am as Z,ak as ee,Y as te,v as ae,j as w,g as V,b as S,t as I,n as se,z as ne,w as ie,F as oe}from"./main.ecdeae84.js";import{_ as le,a as re,b as me,c as de,d as ue,e as ce,f as ge}from"./SalesTax.79c9b071.js";import{_ as pe}from"./CreateCustomFields.fd8e629d.js";import{_ as fe}from"./ExchangeRateConverter.7083ccdf.js";import{_ as _e}from"./TaxTypeModal.b38dcb3e.js";import{_ as be}from"./TradeInfoSection.ba545eaf.js";import"./DragIcon.54e59951.js";import"./SelectNotePopup.8821f953.js";import"./NoteModal.291b2a64.js";import"./payment.e4082132.js";import"./exchange-rate.0f985b88.js";const we={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},ve={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(s){const e=M(),v=A();return x(()=>e.newEstimate.currency_id,d=>{const i=v.currencies.find(m=>m.id===d);i&&(e.newEstimate.selectedCurrency=i)}),(d,i)=>{const m=r("BaseCustomerSelectPopup"),c=r("BaseDatePicker"),g=r("BaseInputGroup"),E=r("BaseInput"),y=r("BaseMultiselect"),h=r("BaseInputGrid");return p(),P("div",we,[a(m,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":i[0]||(i[0]=n=>t(e).newEstimate.customer=n),valid:s.v.customer_id,"content-loading":s.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(h,{class:"col-span-7"},{default:o(()=>[a(g,{label:d.$t("reports.estimates.estimate_date"),"content-loading":s.isLoading,required:"",error:s.v.estimate_date.$error&&s.v.estimate_date.$errors[0].$message},{default:o(()=>[a(c,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":i[1]||(i[1]=n=>t(e).newEstimate.estimate_date=n),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(g,{label:d.$t("estimates.expiry_date"),"content-loading":s.isLoading},{default:o(()=>[a(c,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":i[2]||(i[2]=n=>t(e).newEstimate.expiry_date=n),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(g,{label:d.$t("estimates.estimate_number"),"content-loading":s.isLoading,required:"",error:s.v.estimate_number.$error&&s.v.estimate_number.$errors[0].$message},{default:o(()=>[a(E,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":i[3]||(i[3]=n=>t(e).newEstimate.estimate_number=n),"content-loading":s.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(g,{label:d.$t("settings.preferences.currency"),"content-loading":s.isLoading},{default:o(()=>[a(y,{modelValue:t(e).newEstimate.currency_id,"onUpdate:modelValue":i[4]||(i[4]=n=>t(e).newEstimate.currency_id=n),"content-loading":s.isLoading,options:t(v).currencies,label:"name","value-prop":"id",searchable:!0,"track-by":"name",class:"w-full"},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"]),a(fe,{store:t(e),"store-prop":"newEstimate",v:s.v,"is-loading":s.isLoading,"is-edit":s.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"]),a(g,{label:d.$t("trade.contract_number"),"content-loading":s.isLoading},{default:o(()=>[a(E,{modelValue:t(e).newEstimate.contract_number,"onUpdate:modelValue":i[5]||(i[5]=n=>t(e).newEstimate.contract_number=n),"content-loading":s.isLoading,placeholder:d.$t("trade.contract_number_placeholder")},null,8,["modelValue","content-loading","placeholder"])]),_:1},8,["label","content-loading"])]),_:1})])}}},Ee={class:"flex"},ye={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},$e={class:"relative w-full lg:w-1/2"},k="newEstimate",Pe={__name:"EstimateCreate",setup(s){const e=M(),v=J(),d=O(),i=K(),{t:m}=Q();let c=C(!1);const g=C(!1),E=C(["customer","company","customerCustom","estimate","estimateCustom"]);let y=W(),h=X(),n=b(()=>e.isFetchingInitialSettings),F=b(()=>f.value?m("estimates.edit_estimate"):m("estimates.new_estimate")),f=b(()=>y.name==="estimates.edit");const T=b(()=>d.selectedCompanySettings.sales_tax_us_enabled==="YES"&&v.salesTaxUSEnabled),U={estimate_date:{required:_.withMessage(m("validation.required"),B)},estimate_number:{required:_.withMessage(m("validation.required"),B)},reference_number:{maxLength:_.withMessage(m("validation.price_maxlength"),Z(255))},customer_id:{required:_.withMessage(m("validation.required"),B)},exchange_rate:{required:ee(function(){return _.withMessage(m("validation.required"),B),e.showExchangeRate}),decimal:_.withMessage(m("validation.valid_exchange_rate"),te)}},$=ae(U,b(()=>e.newEstimate),{$scope:k});x(()=>e.newEstimate.customer,l=>{l&&l.currency?e.newEstimate.selectedCurrency=l.currency:e.newEstimate.selectedCurrency=d.selectedCompanyCurrency}),e.resetCurrentEstimate(),i.resetCustomFields(),$.value.$reset,e.fetchEstimateInitialSettings(f.value);async function G(){if($.value.$touch(),$.value.$invalid)return!1;c.value=!0;let l={...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};const L=f.value?e.updateEstimate:e.addEstimate;try{let u=await L(l);u.data.data&&h.push(`/admin/estimates/${u.data.data.id}/view`)}catch(u){console.error(u)}c.value=!1}return(l,L)=>{const u=r("BaseBreadcrumbItem"),N=r("BaseBreadcrumb"),q=r("BaseButton"),D=r("router-link"),j=r("BaseIcon"),z=r("BasePageHeader"),H=r("BaseScrollPane"),R=r("BasePage");return p(),P(oe,null,[a(le),a(re),a(_e),T.value&&(!t(n)||t(y).query.customer)?(p(),w(me,{key:0,store:t(e),"store-prop":"newEstimate","is-edit":t(f),customer:t(e).newEstimate.customer},null,8,["store","is-edit","customer"])):V("",!0),a(R,{class:"relative estimate-create-page"},{default:o(()=>[S("form",{onSubmit:ie(G,["prevent"])},[a(z,{title:t(F)},{actions:o(()=>[l.$route.name==="estimates.edit"?(p(),w(D,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:o(()=>[a(q,{class:"mr-3",variant:"primary-outline",type:"button"},{default:o(()=>[S("span",Ee,I(l.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):V("",!0),a(q,{loading:t(c),disabled:t(c),"content-loading":t(n),variant:"primary",type:"submit"},{left:o(Y=>[t(c)?V("",!0):(p(),w(j,{key:0,class:se(Y.class),name:"SaveIcon"},null,8,["class"]))]),default:o(()=>[ne(" "+I(l.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:o(()=>[a(N,null,{default:o(()=>[a(u,{title:l.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(u,{title:l.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),l.$route.name==="estimates.edit"?(p(),w(u,{key:0,title:l.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(p(),w(u,{key:1,title:l.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(ve,{v:t($),"is-loading":t(n),"is-edit":t(f)},null,8,["v","is-loading","is-edit"]),a(be,{store:t(e),"store-prop":"newEstimate","is-loading":t(n),"show-bl-awb":!1},null,8,["store","is-loading"]),a(H,null,{default:o(()=>[a(de,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(n),"item-validation-scope":k,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),S("div",ye,[S("div",$e,[a(ue,{store:t(e),"store-prop":"newEstimate",fields:E.value,type:"Estimate"},null,8,["store","fields"]),a(pe,{type:"Estimate","is-edit":t(f),"is-loading":t(n),store:t(e),"store-prop":"newEstimate","custom-field-scope":k,class:"mb-6"},null,8,["is-edit","is-loading","store"]),a(ce,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":g.value},null,8,["store","is-mark-as-default"])]),a(ge,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(n),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],32)]),_:1})],64)}}};export{Pe as default};
